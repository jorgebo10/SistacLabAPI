/*! sistacLabAPI 07-04-2016 */
!function(){"use strict";var a=require("./a1.model"),b=require("winston"),c=b.loggers.get("sistac-error"),d=require("underscore"),e=function(a,b,d){a.status(b),a.json(d),400!==b&&404!==b||c.error(d)};exports.findByCit=function(b,c){return d.isUndefined(b.query)||d.isUndefined(b.query.cit)?e(c,404,{message:"cit not found in request params"}):void a.findByCit(b.query.cit).then(function(a){return console.log("resolving promise: "+a),e(c,200,a)})},exports.findAll=function(b,c){a.find().select("-sequence -__v").exec(function(a,b){return a?e(c,400,a):e(c,200,b)})},exports.getByNumeroTramite=function(b,c){return b.params&&b.params.id?void a.findOne({numeroTramite:b.params.id}).select("-sequence -__v").exec(function(a,d){return a?e(c,400,a):d?e(c,200,d):e(c,404,{message:"A1 not found by numeroTramite: "+b.params.id})}):e(c,404,{message:"id not found in request params"})},exports.create=function(b,c){a.create({numeroTramite:b.body.numeroTramite,cit:b.body.cit,normaFabricacion:b.body.normaFabricacion,fabricante:b.body.fabricante,matricula:b.body.matricula,estado:b.body.estado,nombreInstalacion:b.body.nombreInstalacion,anioFabricacion:b.body.anioFabricacion,anioInstalacion:b.body.anioInstalacion,placaIdentificacion:b.body.placaIdentificacion,temperaturaOperacion:b.body.temperaturaOperacion,especificacionChapas:b.body.especificacionChapas,numeroInterno:b.body.numeroInterno,observaciones:b.body.observaciones,elevado:b.body.elevado,tieneInspeccionesAnteriores:b.body.tieneInspeccionesAnteriores,laminasInspeccionadas:b.body.laminasInspeccionadas},function(a,b){return a?e(c,400,a):e(c,201,b)})},exports.update=function(b,c){return b.params&&b.params.id?void a.findOne({numeroTramite:b.params.id}).exec(function(a,d){return a?e(c,400,a):d?(d.numeroTramite=b.body.numeroTramite,d.cit=b.body.cit,d.normaFabricacion=b.body.normaFabricacion,d.fabricante=b.body.fabricante,d.nombreInstalacion=b.body.nombreInstalacion,d.matricula=b.body.matricula,d.estado=b.body.estado,d.anioFabricacion=b.body.anioFabricacion,d.anioInstalacion=b.body.anioInstalacion,d.placaIdentificacion=b.body.placaIdentificacion,d.temperaturaOperacion=b.body.temperaturaOperacion,d.especificacionChapas=b.body.especificacionChapas,d.numeroInterno=b.body.numeroInterno,d.observaciones=b.body.observaciones,d.laminasInspeccionadas=b.body.laminasInspeccionadas,d.elevado=b.body.elevado,d.tieneInspeccionesAnteriores=b.body.tieneInspeccionesAnteriores,void d.save(function(a,b){return a?e(c,400,a):e(c,200,b)})):e(c,404,{message:"A1 not found by numeroTramite:"+b.params.id})}):e(c,404,{message:"id not found in request params"})},exports["delete"]=function(b,c){var d=b.params.id;return d?void a.findOneAndRemove({numeroTramite:d}).exec(function(a){return a?e(c,404,a):e(c,204,null)}):e(c,404,{message:"A1 not found by numeroTramite: "+d})}}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=(require("mongoose-auto-increment"),new b({numeroTramite:{type:Number,required:!0,unique:!0,max:9999999},cit:{type:Number,max:9999999,unique:!0},elevado:{type:Boolean,"default":!1},tieneInspeccionesAnteriores:{type:Boolean,"default":!1},nombreInstalacion:{type:String,"default":""},normaFabricacion:String,fabricante:{type:String,"default":""},matricula:{type:String,"default":""},estado:{type:String,"default":""},observaciones:{type:String,"default":""},numeroInterno:{type:String,"default":""},laminasInspeccionadas:{type:Number,"default":0,min:0,max:500},anioFabricacion:{type:Number,min:1800,max:4e3,"default":1800},anioInstalacion:{type:Number,min:1800,max:4e3,"default":1800},placaIdentificacion:{type:String,"default":""},temperaturaOperacion:{type:String,"default":"Ambiente"},especificacionChapas:{type:String,"default":""}}));c["static"]("findByCit",function(a){return this.find({cit:a}).select("-sequence -__v").exec()}),module.exports=a.model("A1",c)}(),function(){"use strict";var a=require("express"),b=require("./a1.controller"),c=require("../../auth/auth.service"),d=a.Router();d.get("/",function(a,c,d){a.query.cit?b.findByCit(a,c):b.findAll(a,c)}),d.get("/:id",c.hasRole("admin"),b.getByNumeroTramite),d.post("/",c.hasRole("admin"),b.create),d.put("/:id",c.hasRole("admin"),b.update),d.patch("/:id",c.hasRole("admin"),b.update),d["delete"]("/:id",c.hasRole("admin"),b["delete"]),module.exports=d}(),function(){"use strict";function a(a){return function(b,c){var d=0;return b[a]<c[a]?d=-1:b[a]>c[a]&&(d=1),d}}function b(a,b){return a.send(500,b)}function c(a){for(var b=[],c=0;c<a.historicos.length;++c){var e=a.historicos[c];e.certificadoAnterior=e.certificado-1;var f=d(b,e.informe._id);-1==f?(e.valorAnterior=0,e.acumulado=0):(e.valorAnterior=b[f].valorAnterior,e.acumulado=b[f].acumulado),-1==f?b.push({informe:e.informe._id,valorAnterior:e.valorActual,acumulado:e.acumulado+e.valorActual}):(b[f].valorAnterior=e.valorActual,b[f].acumulado=e.acumulado+e.valorActual),e.porcentaje=(100*Number(e.valorActual)/Number(e.precioUnitario)).toFixed(2);var g=Number(e.informe.primeraSeccion.perimetro)/Math.PI;e.informe.capacidad=(Math.PI*Math.pow(g/2,2)*Number(e.informe.primeraSeccion.altura)).toFixed(2)}}function d(a,b){for(var c=0;c<a.length;++c)if(a[c].informe==b)return c;return-1}function e(a,b,c){var d=new q;d.info.Title="Certificado",d.info.Author="SisTAC";var e="  ",j="   ";d.font("Times-Bold").fontSize(20).text("Contrato "+b.contrato+" - Certificado "+c,{underline:!0,align:"center"}),d.lineWidth(125),d.fontSize(15),d.moveDown(2),d.font("Times-Bold").text("Registro O/C",{underline:!0,paragraphGap:3}),d.fontSize(12),d.font("Times-Bold").text("O/C Contrato N°: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(b.contrato)),d.font("Times-Bold").text("Fecha inicio: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(h(b.fechaInicio)+e,{continued:!0}).font("Times-Bold").text("Fecha Fin: ",{continued:!0}).font("Times-Roman").text(h(b.fechaFin)+" "),d.font("Times-Bold").text("Nombre de Operador/Cliente: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(b.operador)+e,{continued:!0}).font("Times-Bold").text("CUIT: ",{continued:!0}).font("Times-Roman").text(g(b.cuit)+" "),d.font("Times-Bold").text("Domicilio de facturación: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(b.domicilio)),d.fontSize(13),d.font("Times-Bold").text("Referente Comercial",{underline:!0,paragraphGap:3}),d.fontSize(12),d.font("Times-Bold").text(j+"Nombre: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(b.referenteComercial)),d.font("Times-Bold").text(j+"Teléfono: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(b.telefonoComercial)),d.font("Times-Bold").text(j+"e-mail: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(b.emailComercial)),d.fontSize(13),d.font("Times-Bold").text("Referente Técnico",{underline:!0,paragraphGap:3}),d.fontSize(12),d.font("Times-Bold").text(j+"Nombre: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(b.referenteTecnico)),d.font("Times-Bold").text(j+"Teléfono: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(b.telefonoTecnico)),d.font("Times-Bold").text(j+"e-mail: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(b.emailTecnico)),d.font("Times-Bold").text("Observaciones: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(b.observaciones));var k=i(b.historicos,c);d.fontSize(15),d.moveDown(2),d.font("Times-Bold").text("Seguimiento general",{underline:!0,paragraphGap:3}),d.fontSize(12);for(var l=0;l<k.length;++l){var m=k[l];d.font("Times-Bold").text("TAHH - "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.informe.informeCampoDetails.idTanque)),d.font("Times-Bold").text(j+"Capacidad: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.informe.capacidad)+" mᶾ"),d.font("Times-Bold").text(j+"CIT: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.informe.informeCampoDetails.cit)),d.font("Times-Bold").text(j+"Tipo de insp.: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(f(m.informe.informeCampoDetails.tipoInspeccion))),d.font("Times-Bold").text(j+"Precio unitario: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.precioUnitario)),d.font("Times-Bold").text(j+"Certificado anterior: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.certificadoAnterior)),d.font("Times-Bold").text(j+"% cer.: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.porcentaje)),d.font("Times-Bold").text(j+"Valor anterior: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.valorAnterior)),d.font("Times-Bold").text(j+"Valor actual: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.valorActual)),d.font("Times-Bold").text(j+"Valor acumulado: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.acumulado)),d.font("Times-Bold").text(j+"Fecha insp.: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(h(g(m.informe.informeCampoDetails.fechaHora))),d.font("Times-Bold").text(j+"Fecha próxima insp.: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(h(m.fechaProximaInspeccion)),d.font("Times-Bold").text(j+"Instalación: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.instalacion)),d.font("Times-Bold").text(j+"Auditor/es: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.auditor)),d.font("Times-Bold").text(j+"Fecha SEN: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(h(m.fechaSEN)),d.font("Times-Bold").text(j+"Estado: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.estado)),d.font("Times-Bold").text(j+"Observaciones: "+e,{continued:!0,paragraphGap:1}).font("Times-Roman").text(g(m.observaciones)),d.moveDown(1)}d.pipe(a),d.end()}function f(a){return"TANQUE_ABIERTO"===a?"Tanque abierto":"TANQUE_CERRADO"===a?"Tanque cerrado/E.A.":text}function g(a){return void 0===a||""===a||"NaN"===a?"<sin dato>":a}function h(a){return void 0===a?"<sin dato>":String(a.getDate())+"/"+String(a.getMonth()+1)+"/"+String(a.getFullYear())}function i(a,b){for(var c=[],d=0;d<a.length;++d)a[d].certificado==b&&c.push(a[d]);return c}var j=require("lodash"),k=require("./contrato.model"),l=require("../contratoinforme/contratoinforme.model"),m=require("../contratoinformehistorico/contratoinformehistorico.model"),n=require("../informe/informe.model"),o=require("winston"),p=o.loggers.get("sistac-error"),q=(o.loggers.get("sistac-info"),require("pdfkit"));exports.index=function(c,d){k.find(function(c,e){return c?b(d,c):d.json(200,e.sort(a("contrato")))})},exports.show=function(a,c){k.findById(a.params.id,function(d,e){return d?(p.error("ERROR AL BUSCAR CONTRATO "+a.params.id+" - "+d),b(c,d)):e?void l.find({contrato:e._id},{contrato:0,__v:0},function(b,d){return b&&p.error("ERROR AL BUSCAR TANQUES DE CONTRATO "+a.params.id+" - "+b),e.informes=d,d.length>0?void m.find({contrato:e._id},{contrato:0,__v:0},function(a,b){return a&&p.error("ERROR AL BUSCAR CERTIFICADO - Contrato: "+e._id+a),e.historicos=b,c.json(e)}).sort({certificado:1}):c.json(e)}).populate("informe"):c.send(404)})},exports.create=function(a,c){k.create(a.body,function(a,d){return a?b(c,a):c.json(201,d)})},exports.update=function(a,c){a.body._id&&delete a.body._id,k.findById(a.params.id,function(d,e){if(d)return b(c,d);if(!e)return c.send(404);var f=j.merge(e,a.body);f.save(function(a){return a?b(c,a):c.json(200,e)})})},exports.destroy=function(a,c){k.findById(a.params.id,function(d,e){return d?b(c,d):e?void e.remove(function(d){return d?b(c,d):(l.find({contrato:a.params.id},{contrato:0,__v:0},function(b,c){b&&p.error("ERROR AL BUSCAR TANQUES DE CONTRATO "+a.params.id+" - "+b);for(var d=0;d<c.length;++d)n.findById(c[d].informe,function(a,b){a&&p.error("Error al actualizar el contrato en el Informe(busqueda) "+a),b.contrato=void 0,b.save(function(a){a&&p.error("Error al actualizar el contrato en el Informe "+a)})}),c[d].remove(function(a){a&&p.error("Error al eliminar Contrato/Informe "+a)});c.length>0&&m.find({contrato:a.params.id},{contrato:0,__v:0},function(b,c){b&&p.error("ERROR AL BUSCAR CERTIFICADO - Contrato: "+a.params.id+b);for(var d=0;d<c.length;++d)c[d].remove(function(a){a&&p.error("Error al eliminar histórico de Contrato/Informe "+a)})})}),c.send(204))}):c.send(404)})},exports.getByName=function(a,c){k.findOne({contrato:a.params.contrato.toUpperCase()},function(d,e){return d?(p.error("Error al buscar Contrato "+a.params.contrato),b(c,d)):e?c.json(200,e):c.send(404)})},exports.exportData=function(a,d){try{k.findById(a.params.id,function(f,g){return f?(p.error("ERROR AL BUSCAR CONTRATO "+a.params.id+" - "+f),b(d,f)):g?void m.find({contrato:g._id,certificado:{$lte:a.params.certificado}},{__v:0},function(b,f){b&&p.error("ERROR AL BUSCAR CERTIFICADO DE CONTRATO "+a.params.id+" - "+b),g.historicos=f,c(g),e(d,g,a.params.certificado)}).populate("informe").sort({certificado:1}):d.send(404)})}catch(f){p.error("Error al generar reporte de Contrato - "+f),d.send(500,{message:"Error al generar reporte de Contrato ",err:f})}}}(),function(){"use strict";var a=require("mongoose-auto-increment"),b=require("mongoose"),c=b.Schema,d=new c({contrato:{type:String,index:{unique:!0},uppercase:!0},fechaInicio:Date,fechaFin:Date,operador:String,cuit:String,domicilio:String,referenteComercial:String,emailComercial:{type:String,lowercase:!0},telefonoComercial:String,referenteTecnico:String,emailTecnico:{type:String,lowercase:!0},telefonoTecnico:String,observaciones:String,active:{type:Boolean,"default":!0},informes:Array,historicos:Array,certificados:Array});d.plugin(a.plugin,{model:"Contrato",field:"sequence",startAt:1}),module.exports=b.model("Contrato",d)}(),function(){"use strict";var a=(require("should"),require("../../app")),b=require("supertest");describe("GET /lab/contratos",function(){it("should respond with JSON array",function(c){b(a).get("/lab/contratos").expect(200).expect("Content-Type",/json/).end(function(a,b){return a?c(a):(b.body.should.be["instanceof"](Array),void c())})})})}(),function(){"use strict";var a=require("express"),b=require("./contrato.controller"),c=require("../../auth/auth.service"),d=a.Router();d.get("/",c.hasRole("comercial"),b.index),d.get("/:id",c.hasRole("comercial"),b.show),d.post("/",c.hasRole("comercial"),b.create),d.put("/:id",c.hasRole("comercial"),b.update),d.patch("/:id",c.hasRole("comercial"),b.update),d["delete"]("/:id",c.hasRole("comercial"),b.destroy),d.get("/contratoByName/:contrato",c.hasRole("comercial"),b.getByName),d.get("/export-data/:id/:certificado",c.hasRole("comercial"),b.exportData),module.exports=d}(),function(){"use strict";function a(a,b){return a.send(500,b)}var b=require("lodash"),c=require("./contratoinforme.model"),d=require("winston"),e=d.loggers.get("sistac-error");exports.index=function(b,d){c.find(function(b,c){return b?a(d,b):d.json(200,c)})},exports.show=function(b,d){c.findById(b.params.id,function(b,c){return b?a(d,b):c?d.json(c):d.send(404)})},exports.create=function(b,d){c.create(b.body,function(b,c){return b?a(d,b):d.json(201,c)})},exports.update=function(d,e){d.body._id&&delete d.body._id,c.findById(d.params.id,function(c,f){if(c)return a(e,c);if(!f)return e.send(404);var g=b.merge(f,d.body);g.save(function(b){return b?a(e,b):e.json(200,f)})})},exports.destroy=function(b,d){c.findById(b.params.id,function(b,c){return b?a(d,b):c?void c.remove(function(b){return b?a(d,b):d.send(204)}):d.send(404)})},exports.getContratoInforme=function(b,d){c.findOne({informe:b.params.informeId},function(c,f){return c?(e.error("Error al buscar Contrato/Informe "+b.params.informeId),a(d,c)):f?d.json(200,f):d.send(404)}).populate("contrato")},exports.updateContratoInforme=function(d,e){c.findById(d.body._id,function(c,f){if(c)return a(e,c);if(!f)return e.send(404);var g=b.merge(f,d.body);g.save(function(b){return b?a(e,b):e.json(200,f)})})}}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({contrato:{type:b.Types.ObjectId,ref:"Contrato"},informe:{type:b.Types.ObjectId,ref:"Informe"},precioUnitario:Number,fechaProximaInspeccion:Date,instalacion:String,fechaInicio:Date,auditor:String,estado:String,fechaSEN:Date,observaciones:String,valorAnterior:Number,valorActual:Number});module.exports=a.model("Contratoinforme",c)}(),function(){"use strict";var a=(require("should"),require("../../app")),b=require("supertest");describe("GET /lab/contratoinforme",function(){it("should respond with JSON array",function(c){b(a).get("/lab/contratoinforme").expect(200).expect("Content-Type",/json/).end(function(a,b){return a?c(a):(b.body.should.be["instanceof"](Array),void c())})})})}(),function(){"use strict";var a=require("express"),b=require("./contratoinforme.controller"),c=require("../../auth/auth.service"),d=a.Router();d.get("/",c.hasRole("comercial"),b.index),d.get("/:id",c.hasRole("comercial"),b.show),d.post("/",c.hasRole("comercial"),b.create),d.put("/:id",c.hasRole("comercial"),b.update),d.patch("/:id",c.hasRole("comercial"),b.update),d["delete"]("/:id",c.hasRole("comercial"),b.destroy),d.get("/contratoInforme/:informeId",c.hasRole("comercial"),b.getContratoInforme),d.post("/updateContratoInforme",c.hasRole("comercial"),b.updateContratoInforme),module.exports=d}(),function(){"use strict";function a(a,b){return a.send(500,b)}var b=require("lodash"),c=require("./contratoinformehistorico.model"),d=require("winston"),e=d.loggers.get("sistac-error"),f=d.loggers.get("sistac-info");exports.index=function(b,d){c.find(function(b,c){return b?a(d,b):d.json(200,c)})},exports.show=function(b,d){c.findById(b.params.id,function(b,c){return b?a(d,b):c?d.json(c):d.send(404)})},exports.create=function(b,d){c.create(b.body,function(b,c){return b?a(d,b):d.json(201,c)})},exports.update=function(d,e){d.body._id&&delete d.body._id,c.findById(d.params.id,function(c,f){if(c)return a(e,c);if(!f)return e.send(404);var g=b.merge(f,d.body);g.save(function(b){return b?a(e,b):e.json(200,f)})})},exports.destroy=function(b,d){c.findById(b.params.id,function(b,c){return b?a(d,b):c?void c.remove(function(b){return b?a(d,b):d.send(204)}):d.send(404)})},exports.getContratoInformeHistorico=function(a,b){console.log("LLEGA "+a.params.contrato+" Cert: "+a.params.certificado),c.find({contrato:a.params.contrato,certificado:a.params.certificado},{contrato:0,__v:0},function(c,d){return c&&(console.log("ERR1 "+c),e.error("ERROR AL BUSCAR CERTIFICADO - Contrato: "+a.params.contrato+", Certificado: "+a.params.certificado+" - "+c)),d||console.log("ERR2 "),console.log("OBTIENE HISTORICOS "+d.length+"-"),b.json(d)}).populate("informe")},exports.getContratoInformeHistoricoAnterior=function(a,b){console.log("LLEGA "+a.params.contrato+" Cert: "+a.params.certificado),c.find({contrato:a.params.contrato},{contrato:0,__v:0},function(c,d){return c&&(console.log("ERR1 "+c),e.error("ERROR AL BUSCAR CERTIFICADO - Contrato: "+a.params.contrato+", Certificado: "+a.params.certificado+" - "+c)),d||console.log("ERR2 "),console.log("OBTIENE HISTORICOS "+d.length+"-"),d.length>0&&console.log("INF "+d[0].certificado),b.json(200,d)}).populate("informe").sort({certificado:-1})},exports.getCertificadosContrato=function(a,b){c.distinct("certificado",{contrato:a.params.contrato},function(c,d){return c&&e.error("ERROR AL BUSCAR CERTIFICADOS DEL CONTRATO: "+a.params.contrato+" - "+c),d||f.info("!CERTIFICADOS DEL CONTRATO: "+a.params.contrato),b.json(200,d)})}}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({contrato:{type:b.Types.ObjectId,ref:"Contrato"},certificado:Number,informe:{type:b.Types.ObjectId,ref:"Informe"},precioUnitario:Number,fechaProximaInspeccion:Date,instalacion:String,fechaInicio:Date,auditor:String,estado:String,fechaSEN:Date,observaciones:String,valorAnterior:Number,valorActual:Number});module.exports=a.model("ContratoinformeHistorico",c)}(),function(){"use strict";var a=(require("should"),require("../../app")),b=require("supertest");describe("GET /lab/contratoinformehistorico",function(){it("should respond with JSON array",function(c){b(a).get("/lab/contratoinformehistorico").expect(200).expect("Content-Type",/json/).end(function(a,b){return a?c(a):(b.body.should.be["instanceof"](Array),void c())})})})}(),function(){"use strict";var a=require("express"),b=require("./contratoinformehistorico.controller"),c=require("../../auth/auth.service"),d=a.Router();d.get("/",c.hasRole("comercial"),b.index),d.get("/:id",c.hasRole("comercial"),b.show),d.post("/",c.hasRole("comercial"),b.create),d.put("/:id",c.hasRole("comercial"),b.update),d.patch("/:id",c.hasRole("comercial"),b.update),d["delete"]("/:id",c.hasRole("comercial"),b.destroy),d.get("/certificadosContrato/:contrato",c.hasRole("comercial"),b.getCertificadosContrato),d.get("/contratoInformeHistorico/:contrato/:certificado",c.hasRole("comercial"),b.getContratoInformeHistorico),d.get("/contratoInformeHistoricoAnterior/:contrato",c.hasRole("comercial"),b.getContratoInformeHistoricoAnterior),module.exports=d}(),function(){"use strict";function a(a,b){a.medicionesChapas=[],a.espesoresPiso=[],a.espesoresEnvolvente=[],a.espesoresAsentamiento=[],a.espesoresCabezales=[],a.espesoresAccesorios=[],a.espesoresCunas=[],a.espesoresTecho=[],a.observacionesMFL=[],a.medicionesAlturaVirolas=[],o.find({informe:a._id},function(c,d){c&&l.error("Error al buscar las mediciones del informe "+a._id),a.medicionesChapas=d,p.find({informe:a._id},function(c,d){c&&l.error("Error al buscar los espesores de Piso del informe "+a._id),a.espesoresPiso=d,r.find({informe:a._id},function(c,d){c&&l.error("Error al buscar los espesores de Envolvente del informe "+a._id),a.espesoresEnvolvente=d,t.find({informe:a._id},function(c,d){c&&l.error("Error al buscar los espesores de Asentamiento del informe "+a._id),a.espesoresAsentamiento=d,v.find({informe:a._id},function(c,d){c&&l.error("Error al buscar los espesores de Cabezales del informe "+a._id),a.espesoresCabezales=d,s.find({informe:a._id},function(c,d){c&&l.error("Error al buscar los espesores de Accesorios del informe "+a._id),a.espesoresAccesorios=d,u.find({informe:a._id},function(c,d){c&&l.error("Error al buscar los espesores de Cunas del informe "+a._id),a.espesoresCunas=d,q.find({informe:a._id},function(c,d){c&&l.error("Error al buscar los espesores de Techo del informe "+a._id),a.espesoresTecho=d,w.find({informe:a._id},function(c,d){c&&l.error("Error al buscar las Observaciones MFL del informe "+a._id),a.observacionesMFL=d,n.find({informe:a._id},function(c,d){c&&l.error("Error al buscar las mediciones en la altura de las virolas "+a._id),a.medicionesAlturaVirolas=d,b(a)})})})})})})})})})})}function b(a,b){function c(a){return a?"Si":"No"}var d=new j;d.info.Title="Informe",d.info.Author="SisTAC";var e="TANQUE_ABIERTO"==b.informeCampoDetails.tipoInspeccion,f="VOLUMEN_TANQUE_MENOR_160"==b.informeCampoDetails.volumen,g="HORIZONTAL"==b.informeCampoDetails.tipoTanque,h="  ",i="   ",k="> 160 m3";f&&(k="< 160 m3");var l="Cimientos",m="Altura",n="Techo";g&&(l="Apoyos",m="Largo",n="Lomo");var o="";switch(b.segundaSeccion.metodoCalefaccion){case"NO":o="No";break;case"SERPENTINA":o="Serpentina";break;case"TUBO_DE_FUEGO":o="Tubo de Fuego";break;case"RE_CIRCULACION":o="Por Re-Circulación"}var p="";switch(b.terceraSeccion.tieneBarandaPerimetral){case"NO":p="No";break;case"TOTAL":p="Total";break;case"PARCIAL":p="Parcial"}var q="";switch(b.quintaSeccion.caracteristicaTanque){case"AISLADO":q="Aislado";break;case"SOLDADO":q="Soldado";break;case"ROBLONADO":q="Reblonado"}d.font("Times-Bold").fontSize(20).text("Informe de tanque "+b.informeCampoDetails.idTanque,{underline:!0,align:"center"}),d.lineWidth(125),d.fontSize(15),d.moveDown(2),d.font("Times-Bold").text("Datos generales",{underline:!0,paragraphGap:3}),d.fontSize(12),d.font("Times-Bold").text("ID Tanque: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.informeCampoDetails.idTanque),d.font("Times-Bold").text("CIT: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.informeCampoDetails.cit),d.font("Times-Bold").text("Tipo de tanque: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.informeCampoDetails.tipoTanque),g||d.font("Times-Bold").text("Tipo de tanque: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.informeCampoDetails.tipoInspeccion),d.font("Times-Bold").text("Volúmen: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(k),d.font("Times-Bold").text("Fecha y hora: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.informeCampoDetails.fechaHora),d.font("Times-Bold").text("Calle: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.informeCampoDetails.calle),d.font("Times-Bold").text("Localidad: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.informeCampoDetails.localidad),d.font("Times-Bold").text("Provincia: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.informeCampoDetails.provincia),d.font("Times-Bold").text("Entidad auditora: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.informeCampoDetails.entidadAuditora),d.font("Times-Bold").text("Inspector: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.informeCampoDetails.inspector),d.font("Times-Bold").text("Operador: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.informeCampoDetails.operador),d.fontSize(15),d.moveDown(2),d.font("Times-Bold").text("Checklist",{underline:!0,paragraphGap:3}),d.fontSize(13),d.font("Times-Bold").text("Identificación del tanque",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text("Placa TK: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.primeraSeccion.tienePlacaTk)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.tienePlacaTkObservaciones+" "),d.font("Times-Bold").text("Número: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.primeraSeccion.tieneNumero)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.tieneNumeroObservaciones+" "),d.font("Times-Bold").text("Capacidad nominal: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.primeraSeccion.tieneCapacidadNominal)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.tieneCapacidadNominalObservaciones+" "),d.font("Times-Bold").text("Producto almacenado: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.primeraSeccion.tieneProductoAlmacenado)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.tieneProductoAlmacenadoObservaciones+" "),d.font("Times-Bold").text("Logo operador: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.primeraSeccion.tieneLogoOperador)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.tieneLogoOperadorObservaciones+" "),d.font("Times-Bold").text("Identificador de riesgo: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.primeraSeccion.tieneIdentificadorRiesgo)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.tieneIdentificadorRiesgoObservaciones+" "),d.font("Times-Bold").text("Carta conversión altura/volúmen: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.primeraSeccion.tieneCartaConversion)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.tieneCartaConversionObservaciones+" "),d.fontSize(13),d.font("Times-Bold").text("Datos técnicos",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text("Perímetro(mts.): ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.primeraSeccion.perimetro+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.perimetroObservaciones+" "),d.font("Times-Bold").text(m+"(mts.): ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.primeraSeccion.altura+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.alturaObservaciones+" "),d.font("Times-Bold").text("Cantidad de virolas: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(b.segundaSeccion.cantidadVirolas+h),d.fontSize(13),d.font("Times-Bold").text(l,{underline:!0,paragraphGap:2}),d.fontSize(12),g||(d.font("Times-Bold").text("Tiene Pestaña piso: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.primeraSeccion.tienePestaniaPiso)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.tienePestaniaPisoObservaciones+" "),d.font("Times-Bold").text("Tiene Talón Bituminoso: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.primeraSeccion.tieneTalonBituminoso)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.tieneTalonBituminosoObservaciones+" ")),d.font("Times-Bold").text("Tiene Hormigón armado: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.primeraSeccion.tieneHormigonArmado)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.tieneHormigonArmadoObservaciones+" "),g?(d.font("Times-Bold").text("Tiene Acero/Hierro: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.primeraSeccion.tieneAceroHierro)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.aceroHierroObservaciones+" "),d.font("Times-Bold").text("Tiene Mampostería: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.primeraSeccion.tieneMamposteria)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.mamposteriaObservaciones+" ")):d.font("Times-Bold").text("Tiene Anclajes: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.primeraSeccion.tieneAnclajes)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.primeraSeccion.tieneAnclajesObservaciones+" "),d.fontSize(13),d.font("Times-Bold").text("Pared externa",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text("Soldaduras: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.segundaSeccion.tieneSoldaduras)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.segundaSeccion.tieneSoldadurasObservaciones+" "),d.font("Times-Bold").text("Globos: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.segundaSeccion.tieneGlobos)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.segundaSeccion.tieneGlobosObservaciones+" "),d.font("Times-Bold").text("Hundimientos: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.segundaSeccion.tieneHundimientos)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.segundaSeccion.tieneHundimientosObservaciones+" "),g||d.font("Times-Bold").text("Boca de limpieza: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.segundaSeccion.tieneBocaLimpieza)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.segundaSeccion.tieneBocaLimpiezaObservaciones+" "),d.font("Times-Bold").text("Boca de hombre: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.segundaSeccion.tieneBocaHombre)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.segundaSeccion.tieneBocaHombreObservaciones+" "),d.font("Times-Bold").text("Medidor de nivel: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.segundaSeccion.tieneMedidorNivelPared)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.segundaSeccion.tieneMedidorNivelParedObservaciones+" "),d.font("Times-Bold").text("Succión: ",{continued:!0,
paragraphGap:1}).font("Times-Roman").text(c(b.segundaSeccion.tieneSuccion)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.segundaSeccion.tieneSuccionObservaciones+" "),d.font("Times-Bold").text("Carga: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.segundaSeccion.tieneCarga)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.segundaSeccion.tieneCargaObservaciones+" "),d.font("Times-Bold").text("Drenaje: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.segundaSeccion.tieneDrenaje)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.segundaSeccion.tieneDrenajeObservaciones+" "),g||d.font("Times-Bold").text("Telemedición: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.segundaSeccion.tieneTelemedicion)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.segundaSeccion.tieneTelemedicionObservaciones+" "),g?d.font("Times-Bold").text("Pintura: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.segundaSeccion.tienePintura)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.segundaSeccion.tienePinturaObservaciones+" "):(d.font("Times-Bold").text("Pintura: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.segundaSeccion.tienePintura)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.segundaSeccion.tienePinturaObservaciones+" "),d.font("Times-Bold").text("Calefacción: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(o)),d.fontSize(13),d.font("Times-Bold").text("Chapas por virola",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text(i+"Cantidad: ",{continued:!0,paragraphGap:2}).font("Times-Roman").text(b.medicionesChapas.length);for(var r=0;r<b.medicionesChapas.length;++r)d.font("Times-Bold").text(i+"Chapa "+b.medicionesChapas[r].numeroChapa+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text("Largo: "+b.medicionesChapas[r].largo+h+"Ancho: "+b.medicionesChapas[r].ancho);if(d.fontSize(13),d.font("Times-Bold").text(n,{underline:!0,paragraphGap:2}),d.fontSize(12),g||(d.font("Times-Bold").text("Tipo: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneTecho)+h,{continued:!0}).font("Times-Roman").text(b.terceraSeccion.tipoTecho+h).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.tipoTechoObservaciones+" "),d.font("Times-Bold").text("Chapas: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneChapasTecho)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.chapasTechoObservaciones+" "),d.font("Times-Bold").text("Sellos: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneSellos)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.sellosObservaciones+" "),d.font("Times-Bold").text("Respiraderos: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneRespiradores)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.respiradoresObservaciones+" ")),d.font("Times-Bold").text("Boca de hombre: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneBocaHombreTecho)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.bocaHombreTechoObservaciones+" "),g&&d.font("Times-Bold").text("Boca de medición: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneBocaMedicion)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.bocaMedicionObservaciones+" "),d.font("Times-Bold").text("Succión: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneSuccion)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.succionObservaciones+" "),d.font("Times-Bold").text("Medidor de nivel: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneMedidorNivel)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.medidorNivelObservaciones+" "),g&&d.font("Times-Bold").text("Control de nivel: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneControlNivel)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.controlNivelObservaciones+" "),d.font("Times-Bold").text("Cañería de carga: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneCanieria)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.canieriaObservaciones+" "),d.font("Times-Bold").text("Poncho: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tienePoncho)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.ponchoObservaciones+" "),d.font("Times-Bold").text("Venteos: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneVenteos)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.venteosObservaciones+" "),d.font("Times-Bold").text("Válvulas presión/vacío: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneValvulas)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.valvulasObservaciones+" "),d.font("Times-Bold").text("Pintura: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tienePintura)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.pinturaObservaciones+" "),g?(d.font("Times-Bold").text("Telemedición: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.terceraSeccion.tieneTelemedicion)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.telemedicionObservaciones+" "),d.fontSize(13),d.font("Times-Bold").text("Cabezales",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text(i+"Frontal (A)",{paragraphGap:1}),d.font("Times-Bold").text(i+i+"Medidor de nivel: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.teneMedidorNivelA)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.medidorNivelAObservaciones+" "),d.font("Times-Bold").text(i+i+"Succión: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneSuccionA)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.succionAObservaciones+" "),d.font("Times-Bold").text(i+"Posterior (B)",{paragraphGap:1}),d.font("Times-Bold").text(i+i+"Medidor de nivel: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneMedidorNivelB)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.medidorNivelBObservaciones+" "),d.font("Times-Bold").text(i+i+"Succión: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.teneSuccionB)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.succionBObservaciones+" "),d.font("Times-Bold").text(i+i+"Carga: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.terceraSeccion.tieneCargaB)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.cargaBObservaciones+" ")):(d.font("Times-Bold").text("Telemedición: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneTelemedicion)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.telemedicionObservaciones+" "),d.font("Times-Bold").text("Baranda perimetral: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(p),d.fontSize(13),d.font("Times-Bold").text("Piso",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text("Chapas: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneChapasPiso)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.chapasPisoObservaciones+" "),d.font("Times-Bold").text("Flujo magnético: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneFlujoMagnetico)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.flujoMagneticoObservaciones+" "),d.font("Times-Bold").text("Emisión acústica: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.terceraSeccion.tieneEmisionAcustica)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.emisionAcusticaObservaciones+" ")),d.fontSize(13),d.font("Times-Bold").text("Protecciones",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text("Protección catódica: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneProteccionCatodica)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.proteccionCatodicaObservaciones+" "),d.font("Times-Bold").text("Tomas de tierra: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.terceraSeccion.tieneTomasTierra)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.tomasTierraObservaciones+" "),d.font("Times-Bold").text("Pararrayos: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.terceraSeccion.tienePararrayos)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.terceraSeccion.pararrayosObservaciones+" "),d.fontSize(13),d.font("Times-Bold").text("Escalera del tanque",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text("Plataforma: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.cuartaSeccion.tienePlataforma)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.plataformaObservaciones+" "),d.font("Times-Bold").text("Peldaños: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.cuartaSeccion.tienePeldanios)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.peldaniosObservaciones+" "),d.font("Times-Bold").text("Descansos: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.cuartaSeccion.tieneDescansos)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.descansosObservaciones+" "),d.font("Times-Bold").text("Baranda: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.cuartaSeccion.tieneBaranda)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.tieneBarandaObservaciones+" "),d.fontSize(13),d.font("Times-Bold").text("Recinto del tanque",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text("Tipo recinto: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.cuartaSeccion.tieneRecintoCompartido)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.recintoCompartidoObservaciones+" "),d.font("Times-Bold").text("Largo(mts.): ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.cuartaSeccion.largoRecinto+h,{continued:!0}).font("Times-Bold").text("Ancho(mts.): ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.anchoRecinto+h,{continued:!0}).font("Times-Bold").text("Alto(mts.): ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.altoRecinto),d.font("Times-Bold").text("Iluminación: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.cuartaSeccion.tieneIluminacionRecinto)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.recintoIluminacionObservaciones+" "),d.font("Times-Bold").text("Drenajes: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.cuartaSeccion.tieneDrenajesRecinto)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.recintoDrenajesObservaciones+" "),d.font("Times-Bold").text("Método de recuperación: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.cuartaSeccion.tieneMetodoRecuperacion)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.metodoRecuperacionObservaciones+" "),d.fontSize(13),d.font("Times-Bold").text("Rampa de acceso",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text("Rampa: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.cuartaSeccion.tieneRampas)+h,{continued:!0}).font("Times-Bold").text("Cantidad: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.cantidadRampas+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.rampaCantidadObservaciones+" "),d.font("Times-Bold").text("Pasarela: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.cuartaSeccion.tieneRampaPasarela)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.rampaPasarelaObservaciones+" "),d.font("Times-Bold").text("Escalones: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.cuartaSeccion.tieneRampaEscalones)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.tieneRampaEscalonesObservaciones+" "),d.font("Times-Bold").text("Iluminación: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.cuartaSeccion.tieneRampaIluminacion)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.cuartaSeccion.tieneRampaIluminacionObservaciones+" "),d.fontSize(13),d.font("Times-Bold").text("Medidor de nivel",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text("Flotante: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.quintaSeccion.tieneFlotante)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.quintaSeccion.flotanteObservaciones+" "),d.font("Times-Bold").text("Alambre: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.quintaSeccion.tieneAlambre)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.quintaSeccion.alambreObservaciones+" "),d.font("Times-Bold").text("Guías de alambre: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.quintaSeccion.tieneGuiasAlambre)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.quintaSeccion.tieneGuiasAlambreObservaciones+" "),d.fontSize(13),d.font("Times-Bold").text("Mantenimiento del tanque",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text("Mantenimiento del tanque: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.quintaSeccion.tieneMantenimientoTanque)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.quintaSeccion.mantenimientoTanqueObservaciones+" "),d.font("Times-Bold").text("Mantenimiento del cañerías: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.quintaSeccion.tieneMantenimientoCanierias)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.quintaSeccion.mantenimientoCanieriasObservaciones+" "),d.font("Times-Bold").text("Mantenimiento del recinto: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.quintaSeccion.tieneMantenimientoRecinto)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.quintaSeccion.mantenimientoRecintoObservaciones+" "),d.fontSize(13),d.font("Times-Bold").text("Tipo de tanque y coordenadas",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text("Caracteristica del tanque: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(q),d.font("Times-Bold").text("Latitud: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(b.quintaSeccion.latitud+h,{continued:!0}).font("Times-Bold").text("Longitud: ",{continued:!0}).font("Times-Roman").text(b.quintaSeccion.longitud),d.fontSize(13),d.font("Times-Bold").text("Sistema contra incendio",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Bold").text("Extintores hasta 10Kg.: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.sextaSeccion.tieneExtintores10K)+h,{continued:!0}).font("Times-Roman").text(b.sextaSeccion.extintores10KClase+h,{continued:!0}).font("Times-Bold").text("Cantidad: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.extintores10KCantidad+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.extintores10KObservaciones+" "),d.font("Times-Bold").text("Extintores hasta 50Kg.: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.sextaSeccion.tieneExtintores50K)+h,{continued:!0}).font("Times-Roman").text(b.sextaSeccion.extintores50KClase+h,{continued:!0}).font("Times-Bold").text("Cantidad: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.extintores50KCantidad+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.extintores50KObservaciones+" "),d.font("Times-Bold").text("Espumígeno: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.sextaSeccion.tieneEspumigeno)+h,{continued:!0}).font("Times-Bold").text("Cantidad: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.espumigenoCantidad+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.espumigenoObservaciones+" "),d.font("Times-Bold").text("Rociadores: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.sextaSeccion.tieneRociadores)+h,{continued:!0}).font("Times-Bold").text("Cantidad: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.rociadoresCantidad+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.rociadoresObservaciones+" "),d.font("Times-Bold").text("Hidrantes: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.sextaSeccion.tieneHidrantes)+h,{continued:!0}).font("Times-Bold").text("Cantidad: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.hidrantesCantidad+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.hidrantesObservaciones+" "),d.font("Times-Bold").text("Lanzas: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.sextaSeccion.tieneLanzas)+h,{continued:!0}).font("Times-Bold").text("Cantidad: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.lanzasCantidad+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.lanzasObservaciones+" "),d.font("Times-Bold").text("Servicio propio de bomberos: ",{continued:!0,paragraphGap:1}).font("Times-Roman").text(c(b.sextaSeccion.tieneServicioPropioBomberos)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.servicioPropioBomberosObservaciones+" "),d.font("Times-Bold").text("Tambor de arena, baldes: ",{continued:!0,paragraphGap:3}).font("Times-Roman").text(c(b.sextaSeccion.tieneBaldes)+h,{continued:!0}).font("Times-Bold").text("Observaciones: ",{continued:!0}).font("Times-Roman").text(b.sextaSeccion.baldesObservaciones+" "),d.fontSize(13),d.font("Times-Bold").text("Observaciones generales",{underline:!0,paragraphGap:2}),d.fontSize(12),d.font("Times-Roman").text(b.sextaSeccion.observacionesGenerales+" "),!g)for(d.fontSize(15),d.moveDown(2),d.font("Times-Bold").text("Registro de espesores(Piso)",{underline:!0,paragraphGap:3}),d.fontSize(12),r=0;r<b.espesoresPiso.length;++r)d.font("Times-Bold").text(i+"Chapa N° "+b.espesoresPiso[r].chapa,{paragraphGap:1}),d.font("Times-Bold").text(i+i+"Medición 1"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresPiso[r].medicion1+"mm."),d.font("Times-Bold").text(i+i+"Medición 2"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresPiso[r].medicion2+"mm."),d.font("Times-Bold").text(i+i+"Medición 3"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresPiso[r].medicion3+"mm."),d.font("Times-Bold").text(i+i+"Medición 4"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresPiso[r].medicion4+"mm."),d.font("Times-Bold").text(i+i+"Medición 5"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresPiso[r].medicion5+"mm."),d.font("Times-Bold").text(i+i+"Medición 6"+h,{continued:!0,paragraphGap:3}).font("Times-Roman").text(b.espesoresPiso[r].medicion6+"mm.");for(d.fontSize(15),d.moveDown(2),d.font("Times-Bold").text("Registro de espesores(Envolvente)",{underline:!0,paragraphGap:3}),d.fontSize(12),r=0;r<b.espesoresEnvolvente.length;++r)d.font("Times-Bold").text(i+"Virola "+b.espesoresEnvolvente[r].virola+h+"Generatriz "+b.espesoresEnvolvente[r].generatriz,{paragraphGap:1}),d.font("Times-Bold").text(i+i+"Medición 1"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresEnvolvente[r].medicion1+"mm."),d.font("Times-Bold").text(i+i+"Medición 2"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresEnvolvente[r].medicion2+"mm."),d.font("Times-Bold").text(i+i+"Medición 3"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresEnvolvente[r].medicion3+"mm."),d.font("Times-Bold").text(i+i+"Medición 4"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresEnvolvente[r].medicion4+"mm."),d.font("Times-Bold").text(i+i+"Medición 5"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresEnvolvente[r].medicion5+"mm."),d.font("Times-Bold").text(i+i+"Medición 6"+h,{continued:!0,paragraphGap:3}).font("Times-Roman").text(b.espesoresEnvolvente[r].medicion6+"mm.");if(!g&&!f)for(d.fontSize(15),d.moveDown(2),d.font("Times-Bold").text("Registro de espesores(Asentamiento)",{underline:!0,paragraphGap:3}),d.fontSize(12),r=0;r<b.espesoresAsentamiento.length;++r)d.font("Times-Bold").text(i+"Número de estación "+b.espesoresAsentamiento[r].estacion,{paragraphGap:1}),d.font("Times-Bold").text(i+i+"Medición "+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresAsentamiento[r].medicion+"mm."),d.font("Times-Bold").text(i+i+"Observación "+h,{continued:!0,paragraphGap:3}).font("Times-Roman").text(b.espesoresAsentamiento[r].observaciones);if(g)for(d.fontSize(15),d.moveDown(2),d.font("Times-Bold").text("Cabezales",{underline:!0,paragraphGap:3}),d.fontSize(12),r=0;r<b.espesoresCabezales.length;++r)d.font("Times-Bold").text(i+"Lado "+b.espesoresCabezales[r].lado+h+"Generatriz "+b.espesoresCabezales[r].generatriz,{paragraphGap:1}),d.font("Times-Bold").text(i+i+"Medición 1"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCabezales[r].medicion1+"mm."),d.font("Times-Bold").text(i+i+"Medición 2"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCabezales[r].medicion2+"mm."),d.font("Times-Bold").text(i+i+"Medición 3"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCabezales[r].medicion3+"mm."),d.font("Times-Bold").text(i+i+"Medición 4"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCabezales[r].medicion4+"mm."),d.font("Times-Bold").text(i+i+"Medición 5"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCabezales[r].medicion5+"mm."),d.font("Times-Bold").text(i+i+"Medición 6"+h,{continued:!0,paragraphGap:3}).font("Times-Roman").text(b.espesoresCabezales[r].medicion6+"mm.");for(d.fontSize(15),d.moveDown(2),d.font("Times-Bold").text("Registro de espesores(Accesorios)",{underline:!0,paragraphGap:3}),d.fontSize(12),r=0;r<b.espesoresAccesorios.length;++r)d.font("Times-Bold").text(i+b.espesoresAccesorios[r].accesorio,{paragraphGap:1}),d.font("Times-Bold").text(i+i+"Diámetro"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresAccesorios[r].diametro+'"'),d.font("Times-Bold").text(i+i+"Medición 0°"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresAccesorios[r].medicion0+"mm."),d.font("Times-Bold").text(i+i+"Medición 90°"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresAccesorios[r].medicion90+"mm."),d.font("Times-Bold").text(i+i+"Medición 180°"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresAccesorios[r].medicion180+"mm."),d.font("Times-Bold").text(i+i+"Medición 270°"+h,{continued:!0,paragraphGap:3}).font("Times-Roman").text(b.espesoresAccesorios[r].medicion270+"mm.");if(g)for(d.fontSize(15),d.moveDown(2),d.font("Times-Bold").text("Zona crítica",{underline:!0,paragraphGap:3}),d.fontSize(12),r=0;r<b.espesoresCunas.length;++r)d.font("Times-Bold").text(i+"Cuna "+b.espesoresCunas[r].cuna,{paragraphGap:1}),d.font("Times-Bold").text(i+i+"Punto"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].punto),d.font("Times-Bold").text(i+i+"Medición 1"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion1+"mm."),d.font("Times-Bold").text(i+i+"Medición 2"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion2+"mm."),d.font("Times-Bold").text(i+i+"Medición 3"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion3+"mm."),d.font("Times-Bold").text(i+i+"Medición 4"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion4+"mm."),d.font("Times-Bold").text(i+i+"Medición 5"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion5+"mm."),d.font("Times-Bold").text(i+i+"Medición 6"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion6+"mm."),d.font("Times-Bold").text(i+i+"Medición 7"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion7+"mm."),d.font("Times-Bold").text(i+i+"Medición 8"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion8+"mm."),d.font("Times-Bold").text(i+i+"Medición 9"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion9+"mm."),d.font("Times-Bold").text(i+i+"Medición 10"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion10+"mm."),d.font("Times-Bold").text(i+i+"Medición 11"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion11+"mm."),d.font("Times-Bold").text(i+i+"Medición 12"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion12+"mm."),d.font("Times-Bold").text(i+i+"Medición 13"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion13+"mm."),d.font("Times-Bold").text(i+i+"Medición 14"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion14+"mm."),d.font("Times-Bold").text(i+i+"Medición 15"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion15+"mm."),d.font("Times-Bold").text(i+i+"Medición 16"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion16+"mm."),d.font("Times-Bold").text(i+i+"Medición 17"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion17+"mm."),d.font("Times-Bold").text(i+i+"Medición 18"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion18+"mm."),d.font("Times-Bold").text(i+i+"Medición 19"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion19+"mm."),d.font("Times-Bold").text(i+i+"Medición 20"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion20+"mm."),d.font("Times-Bold").text(i+i+"Medición 21"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion21+"mm."),d.font("Times-Bold").text(i+i+"Medición 22"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion22+"mm."),d.font("Times-Bold").text(i+i+"Medición 23"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion23+"mm."),d.font("Times-Bold").text(i+i+"Medición 24"+h,{continued:!0,paragraphGap:3}).font("Times-Roman").text(b.espesoresCunas[r].medicion24+"mm."),d.font("Times-Bold").text(i+i+"Medición 25"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion25+"mm."),d.font("Times-Bold").text(i+i+"Medición 26"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion26+"mm."),d.font("Times-Bold").text(i+i+"Medición 27"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion27+"mm."),d.font("Times-Bold").text(i+i+"Medición 28"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion28+"mm."),d.font("Times-Bold").text(i+i+"Medición 29"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion29+"mm."),d.font("Times-Bold").text(i+i+"Medición 30"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion30+"mm."),d.font("Times-Bold").text(i+i+"Medición 31"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresCunas[r].medicion31+"mm."),d.font("Times-Bold").text(i+i+"Medición 32"+h,{continued:!0,paragraphGap:3}).font("Times-Roman").text(b.espesoresCunas[r].medicion32+"mm.");if(!g)for(d.fontSize(15),d.moveDown(2),d.font("Times-Bold").text("Registro de espesores(Techo)",{underline:!0,paragraphGap:3}),d.fontSize(12),r=0;r<b.espesoresTecho.length;++r)d.font("Times-Bold").text(i+"Chapa N° "+b.espesoresTecho[r].chapa,{paragraphGap:1}),d.font("Times-Bold").text(i+i+"Medición 1"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresTecho[r].medicion1+"mm."),d.font("Times-Bold").text(i+i+"Medición 2"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresTecho[r].medicion2+"mm."),d.font("Times-Bold").text(i+i+"Medición 3"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresTecho[r].medicion3+"mm."),d.font("Times-Bold").text(i+i+"Medición 4"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresTecho[r].medicion4+"mm."),d.font("Times-Bold").text(i+i+"Medición 5"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.espesoresTecho[r].medicion5+"mm."),d.font("Times-Bold").text(i+i+"Medición 6"+h,{continued:!0,paragraphGap:3}).font("Times-Roman").text(b.espesoresTecho[r].medicion6+"mm.");if(!g&&e)for(d.fontSize(15),d.moveDown(2),d.font("Times-Bold").text("Registro de observaciones MFL",{underline:!0,paragraphGap:3}),d.fontSize(12),r=0;r<b.observacionesMFL.length;++r)d.font("Times-Bold").text(i+"Pasada "+b.observacionesMFL[r].pasada+h+"Chapa "+b.observacionesMFL[r].chapa,{paragraphGap:1}),d.font("Times-Bold").text(i+i+"Acceso"+h,{continued:!0,
paragraphGap:1}).font("Times-Roman").text(b.observacionesMFL[r].acceso),d.font("Times-Bold").text(i+i+"Amolado"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.observacionesMFL[r].amolado),d.font("Times-Bold").text(i+i+"Corrosión"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.observacionesMFL[r].corrosion),d.font("Times-Bold").text(i+i+"Deformación"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.observacionesMFL[r].deformacion),d.font("Times-Bold").text(i+i+"Otra"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.observacionesMFL[r].otra),d.font("Times-Bold").text(i+i+"Perforación"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.observacionesMFL[r].perforacion),d.font("Times-Bold").text(i+i+"Punto soldadura"+h,{continued:!0,paragraphGap:1}).font("Times-Roman").text(b.observacionesMFL[r].puntosoldadura),d.font("Times-Bold").text(i+i+"Observaciones"+h,{continued:!0,paragraphGap:3}).font("Times-Roman").text(b.observacionesMFL[r].observaciones);d.pipe(a),d.end()}function c(a,b){return a.send(500,b)}var d=(require("lodash"),require("request")),e=require("../informe/informe.model"),f=require("nodemailer"),g=require("../../config/environment"),h=require("nodemailer-direct-transport"),i=f.createTransport(h({name:"sistemaglobal.com.ar",debug:!1})),j=require("pdfkit"),k=require("winston"),l=k.loggers.get("sistac-error"),m=k.loggers.get("sistac-info"),n=require("../informe/medicionesalturavirolas.model"),o=require("../informe/medicioneschapa.model"),p=require("../informe/espesoresPiso.model"),q=require("../informe/espesoresTecho.model"),r=require("../informe/espesoresEnvolvente.model"),s=require("../informe/espesoresAccesorios.model"),t=require("../informe/espesoresAsentamiento.model"),u=require("../informe/espesoresCunas.model"),v=require("../informe/espesoresCabezales.model"),w=require("../informe/observacionesMFL.model");require("../informe/calculosEspesores.model");exports.sendMail=function(a,b){var c=a.body,e=b;d.post("http://www.google.com/recaptcha/api/verify",{form:{privatekey:g.RECAPTCHA_PRIVATE_KEY,remoteip:a.connection.remoteAddress,challenge:c.captcha.challenge,response:c.captcha.response}},function(a,b,d){null===d.match(/false/)?(i.sendMail({from:"sistac@sistemaglobal.com.ar",to:"sistac@sistemaglobal.com.ar",subject:"Contacto SisTAC",generateTextFromHTML:!0,html:"Nombre y apellido: <b>"+c.nomYApe+"</b><br>País: <b>"+c.pais+"</b><br>Empresa: <b>"+c.empresa+"</b><br>e-mail: <b>"+c.mail+"</b><br>Teléfono: <b>"+c.telefono+"</b><br>Mensaje: <b>"+c.mensaje+"</b>"}),m.info("Enviando mail de contacto"),e.send(200,"Ok")):(l.error("Error al completar captcha - "+a),e.send(500,{message:"Código verificador inválido.",err:a}))})},exports.exportData=function(d,f){try{e.findById(d.params.id,function(d,e){return d?(l.error("Error al obtener el informe: "+e.informeCampoDetails.idTanque),c(f,d)):(m.info("Generando reporte de informe "+e.informeCampoDetails.idTanque),void a(e,function(a,c){b(f,a)}))})}catch(g){l.error("Error al generar informe - "+g),f.send(500,{message:"Error al generar informe",err:g})}}}(),function(){"use strict";var a=require("express"),b=require("./core.controller.js"),c=(require("../../config/environment"),require("../../auth/auth.service")),d=a.Router();d.post("/contact-form",b.sendMail),d.get("/export-data/:id",c.isAuthenticated(),b.exportData),module.exports=d}(),function(){"use strict";var a=require("mongoose"),b=require("../informe/informe.model"),c=require("./empresa.model"),d=require("../../config/environment"),e=require("jsonwebtoken"),f=require("winston"),g=f.loggers.get("sistac-error"),h=function(a,b,c){a.status(b),a.json(c),400!==b&&404!==b||g.error(c)};exports.index=function(a,b){c.find({active:!0}).select("-sequence -__v").exec(function(a,c){return a?h(b,400,a):h(b,200,c)})},exports.getById=function(a,b){return a.params&&a.params.id?void c.findById(a.params.id).select("-sequence -__v").exec(function(c,d){return c?h(b,400,c):d?h(b,200,d):h(b,404,{message:"empresa not found by id: "+a.params.id})}):h(b,404,{message:"id not found in request params"})},exports.create=function(a,b){c.create({nombre:a.body.nombre,razonSocial:a.body.razonSocial,direccion:a.body.direccion,telefono:a.body.telefono,email:a.body.email,password:a.body.password,token:a.body.token,contacto:a.body.contact,imagen:void 0!==a.body.imagen?a.body.imagen.src:""},function(a,c){return a?h(b,400,a):h(b,201,c)})},exports.update=function(a,b){return a.params&&a.params.id?void c.findById(a.params.id).exec(function(c,d){return c?h(b,400,c):d?(d.nombre=a.body.nombre,d.razonSocial=a.body.razonSocial,d.direccion=a.body.direccion,d.telefono=a.body.telefono,d.email=a.body.email,d.password=a.body.password,d.token=a.body.token,d.contacto=a.body.contact,d.imagen=void 0!==a.body.imagen?a.body.imagen.src:"",void d.save(function(a,c){return a?h(b,400,a):h(b,200,c)})):h(b,404,{message:"Empresa not found by id:"+a.params.id})}):h(b,404,{message:"id not found in request params"})},exports["delete"]=function(d,e){var f=d.params.id;return f?void b.findOne({empresa:new a.mongo.ObjectID(f)}).select("_id").exec(function(a,b){return b?h(e,400,{message:"Informes are associated to empresa"}):void c.findByIdAndRemove(f).exec(function(a){return a?h(e,404,a):h(e,204,null)})}):h(e,404,{message:"Empresa not found by id: "+f})},exports.syncTokenRequest=function(a,b,f){if(!a.body||!a.body.nombre||!a.body.password)return h(b,404,{message:"Credentials not found in request body"});var g=String(a.body.nombre).toUpperCase(),i=String(a.body.password);c.findOne({nombre:g},function(a,c){if(a)return f(a);if(!c)return h(b,404,{message:"Empresa not found by nombre: "+g});if(c.password!==i)return b.setHeader("WWW-Authenticate","empresa:pass incorrect"),h(b,401,{message:"Authetication failure"});var j=e.sign({_id:c._id},d.secrets.mobileAuthToken,{expiresInMinutes:43200});return b.json({email:c.email,name:c.razonSocial,token:j})})}}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=require("mongoose-auto-increment"),d=new b({nombre:{type:String,index:{unique:!0},uppercase:!0},razonSocial:String,direccion:String,telefono:String,email:{type:String,lowercase:!0},password:String,token:String,contacto:String,imagen:String,active:{type:Boolean,"default":!0}});d.plugin(c.plugin,{model:"Empresa",field:"sequence",startAt:1}),module.exports=a.model("Empresa",d)}(),function(){"use strict";var a=(require("should"),require("../../app")),b=require("supertest");describe("GET /lab/empresas",function(){it("should respond with JSON array",function(c){b(a).get("/lab/empresas").expect(200).expect("Content-Type",/json/).end(function(a,b){return a?c(a):(b.body.should.be["instanceof"](Array),void c())})})})}(),function(){"use strict";var a=require("express"),b=require("./empresa.controller"),c=require("../../auth/auth.service"),d=a.Router();d.get("/",c.hasRole("admin"),b.index),d.get("/:id",c.hasRole("admin"),b.getById),d.post("/",c.hasRole("admin"),b.create),d.put("/:id",c.hasRole("admin"),b.update),d.patch("/:id",c.hasRole("admin"),b.update),d["delete"]("/:id",c.hasRole("admin"),b["delete"]),d.post("/syncTokenRequest",b.syncTokenRequest),module.exports=d}(),function(){"use strict";function a(a){return j+l+a.filename+"."+a.ext}function b(a){var b=i.readFileSync(k+j+a.filename+"."+a.ext,"base64");return"data:image/"+a.ext+";base64,"+b}var c=require("underscore"),d=require("winston"),e=d.loggers.get("sistac-error"),f=require("./foto.model"),g=require("imagemagick"),h=require("crypto"),i=require("fs"),j="images/",k="public/",l="thumb/",m=function(a,b,c){a.status(b),a.json(c),400!==b&&404!==b||e.error(c)};exports.getById=function(a,b){return a.params&&a.params.id?void f.findById(a.params.id).select("-sequence -__v").exec(function(c,d){return c?m(b,400,c):d?m(b,200,{id:d._id,idInforme:d.idInforme,url:j+l+d.filename+"."+d.ext,syncTime:d.syncTime,descripcion:d.descripcion,tags:d.tags}):m(b,404,{message:"Foto not found by id: "+a.params.id})}):m(b,404,{message:"id not found in request params"})},exports.findByInformeIdAndTags=function(d,e){var g={};if(!d.query.idInforme)return m(e,404,{message:"idInforme not found in request params"});if(g.idInforme=d.query.idInforme,d.query.tag){var h=[];h.push(d.query.tag);var i={$in:h};g.tags=i}f.find(g).select("-sequence -__v").exec(function(f,g){if(f)return m(e,400,f);var h=c.map(g,function(c){var e=d.query.full?a(c):b(c);return{id:c._id,idInforme:c.idInforme,url:e,syncTime:c.syncTime,descripcion:c.descripcion,tags:c.tags}});return m(e,200,h)})},exports["delete"]=function(a,b){var c=a.params.id;c||m(b,404,{message:"Foto not found by id: "+c}),f.findByIdAndRemove(c).select("filename ext").exec(function(a,c){return a?void m(b,404,a):(i.unlinkSync(k+j+c.filename+"."+c.ext),i.unlinkSync(k+j+l+c.filename+"."+c.ext),void m(b,204,null))})},exports.update=function(a,b){return a.params&&a.params.id?void f.findById(a.params.id).select("-sequence -__v").exec(function(c,d){if(c)return void m(b,400,c);if(!d)return void m(b,404,{message:"Foto not found by id:"+a.params.id});var e=a.body.tags,g=a.body.descripcion;f.findOne({informeId:a.body.informeId,tags:{$in:e}}).select("_id").exec(function(a,c){return a?void m(b,400,a):c&&!c._id.equals(d._id)?void m(b,400,{message:"Tags already assinged"}):(d.tags=e,d.descripcion=g,void d.save(function(a){return a?void m(b,400,a):void m(b,200,d)}))})}):void m(b,404,{message:"id not found in request params"})},exports.deleteByInformeId=function(a,b){return a.params&&a.params.id?void f.find({idInforme:a.params.id}).exec(function(a,b){return a?void e.error(a):void c.each(b,function(a){a.remove(function(a){return a?void e.error(a):void 0})})}):void e.error("id not found in request params")},exports.create=function(a,b){var c=null,d=null,e=null;if(!a.body.idInforme)return void m(b,400,{message:"missing idInforme"});if((a.body.imagen||a.body.imagen.src)&&(c=a.body.imagen.src?a.body.imagen.src:a.body.imagen),c){var n=c.match(/^data:.+\/(.+);base64,(.*)$/);e=n&&3==n.length?n[1]:"png";var o=n&&3==n.length?n[2]:c;d=a.body.idInforme+"-"+h.randomBytes(4).readUInt32LE(0),i.writeFileSync(k+j+d+"."+e,new Buffer(o,"base64")),g.resize({srcPath:k+j+d+"."+e,dstPath:k+j+l+d+"."+e,width:200},function(a,c,d){return a||c||d?void m(b,500,a):void 0})}f.create({idInforme:a.body.idInforme,filename:d,ext:e,descripcion:a.body.descripcion,tags:a.body.tags,syncTime:a.body.syncTime},function(a,c){return a?void m(b,400,a):void m(b,201,c)})}}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=require("mongoose-auto-increment"),d=new b({idInforme:{type:String,required:!0},filename:{type:String,required:!0},ext:{type:String,required:!0},descripcion:{type:String,required:!0},tags:{type:Array,"default":[]},syncTime:String});d.plugin(c.plugin,{model:"Foto",field:"sequence",startAt:1}),module.exports=a.model("Foto",d)}(),function(){"use strict";var a=(require("should"),require("../../app")),b=require("supertest");describe("GET /lab/fotos",function(){it("should respond with JSON array",function(c){b(a).get("/lab/fotos").expect(200).expect("Content-Type",/json/).end(function(a,b){return a?c(a):(b.body.should.be["instanceof"](Array),void c())})})})}(),function(){"use strict";var a=require("express"),b=require("./foto.controller"),c=a.Router();c.get("/",b.findByInformeIdAndTags),c.get("/:id",b.getById),c.post("/",b.create),c.post("/sync",b.create),c.put("/:id",b.update),c.patch("/:id",b.update),c["delete"]("/:id",b["delete"]),module.exports=c}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({informe:{type:b.Types.ObjectId,ref:"Informe"},alturaSegura:Number,promedioZC:Number,minimoZC:Number,maximoZC:Number,nominalZC:Number,perdidaZC:Number,corrosionZC:Number,vidaZC:Number,promedioEn:Number,minimoEn:Number,maximoEn:Number,nominalEn:Number,perdidaEn:Number,corrosionEn:Number,vidaEn:Number,promedioCa:Number,minimoCa:Number,maximoCa:Number,nominalCa:Number,perdidaCa:Number,corrosionCa:Number,vidaCa:Number});module.exports=a.model("CalculosEnvolvente",c)}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({informe:{type:b.Types.ObjectId,ref:"Informe"},unidad:String,h:String,d:String,s:String,e:String,tmin:String,tc:String,tmedido:String,tasa:String,vida:String,alturaSegura:String});module.exports=a.model("CalculosEspesores",c)}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({informe:{type:b.Types.ObjectId,ref:"Informe"},accesorio:String,diametro:String,medicion0:String,medicion90:String,medicion180:String,medicion270:String,promedio:String,minimo:String,maximo:String,nominal:String,retiro:String,perdida:String,corrosion:String,vida:String,observaciones:String});module.exports=a.model("EspesoresAccesorios",c)}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({informe:{type:b.Types.ObjectId,ref:"Informe"},estacion:Number,medicion:String,observaciones:String,relativo:String,angulo:String,coseno:String,diferencial:String,syy:String,see:String,syysee:String,k:String});module.exports=a.model("EspesoresAsentamiento",c)}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({informe:{type:b.Types.ObjectId,ref:"Informe"},lado:String,generatriz:String,medicion1:String,medicion2:String,medicion3:String,medicion4:String,medicion5:String,medicion6:String});module.exports=a.model("EspesoresCabezales",c)}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({informe:{type:b.Types.ObjectId,ref:"Informe"},cuna:String,punto:String,medicion1:String,medicion2:String,medicion3:String,medicion4:String,medicion5:String,medicion6:String,medicion7:String,medicion8:String,medicion9:String,medicion10:String,medicion11:String,medicion12:String,medicion13:String,medicion14:String,medicion15:String,medicion16:String,medicion17:String,medicion18:String,medicion19:String,medicion20:String,medicion21:String,medicion22:String,medicion23:String,medicion24:String,medicion25:String,medicion26:String,medicion27:String,medicion28:String,medicion29:String,medicion30:String,medicion31:String,medicion32:String});module.exports=a.model("EspesoresCunas",c)}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({informe:{type:b.Types.ObjectId,ref:"Informe"},virola:Number,generatriz:Number,medicion1:String,medicion2:String,medicion3:String,medicion4:String,medicion5:String,medicion6:String,promedio:String,minimo:String,maximo:String,nominal:String,perdida:String,corrosion:String,vida:String});module.exports=a.model("EspesoresEnvolvente",c)}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({informe:{type:b.Types.ObjectId,ref:"Informe"},chapa:Number,medicion1:String,medicion2:String,medicion3:String,medicion4:String,medicion5:String,medicion6:String,promedio:String,minimo:String,maximo:String,nominal:String,perdida:String,corrosion:String,vida:String});module.exports=a.model("EspesoresPiso",c)}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({informe:{type:b.Types.ObjectId,ref:"Informe"},chapa:Number,medicion1:String,medicion2:String,medicion3:String,medicion4:String,medicion5:String,medicion6:String,promedio:String,minimo:String,maximo:String,nominal:String,perdida:String,corrosion:String,vida:String});module.exports=a.model("EspesoresTecho",c)}(),function(){"use strict";var a=require("express"),b=require("./informe.controller"),c=(require("../../config/environment"),a.Router());c.get("/:id",b.show),c.get("/param/userId",b.getInformesUsuario),c.get("/medicionesAlturaVirolas/:informeId",b.getMedicionesAlturaVirolas),c.get("/medicionesChapa/:informeId",b.getMedicionesChapa),c.get("/espesoresEnvolvente/:informeId",b.getEspesoresEnvolvente),c.get("/espesoresAccesorios/:informeId",b.getEspesoresAccesorios),c.get("/espesoresAsentamiento/:informeId",auth.isAuthenticated(),b.getEspesoresAsentamiento),c.get("/espesoresCunas/:informeId",auth.isAuthenticated(),b.getEspesoresCunas),c.get("/espesoresCabezales/:informeId",auth.isAuthenticated(),b.getEspesoresCabezales),c.get("/espesoresPiso/:informeId",auth.isAuthenticated(),b.getEspesoresPiso),c.get("/espesoresTecho/:informeId",auth.isAuthenticated(),b.getEspesoresTecho),c.get("/observacionesMFL/:informeId",auth.isAuthenticated(),b.getObservacionesMFL),c.get("/:id/cabezalesInfo",b.cabezalesInfoByInformeId),c.post("/espesoresPiso",auth.isAuthenticated(),b.updateEspesoresPiso),c.post("/espesoresTecho",auth.isAuthenticated(),b.updateEspesoresTecho),c.post("/espesoresEnvolvente",auth.isAuthenticated(),b.updateEspesoresEnvolvente),c.post("/espesoresAccesorios",auth.isAuthenticated(),b.updateEspesoresAccesorios),c.post("/espesoresAsentamiento",auth.isAuthenticated(),b.updateEspesoresAsentamiento),c.post("/espesoresCunas",auth.isAuthenticated(),b.updateEspesoresCunas),c.post("/espesoresCabezales",auth.isAuthenticated(),b.updateEspesoresCabezales),c.post("/observacionesMFL",auth.isAuthenticated(),b.updateObservacionesMFL),c.get("/calculosEspesores/:informeId",auth.isAuthenticated(),b.getCalculosEspesores),c.post("/calculosEspesores",auth.isAuthenticated(),b.updateCalculosEspesores),c.post("/crearCalculoEspesor",auth.isAuthenticated(),b.crearCalculoEspesor),c.get("/calculosEnvolventeHorizontal/:informeId",auth.isAuthenticated(),b.getCalculosEnvolvente),c.post("/calculosEnvolvente",auth.isAuthenticated(),b.updateCalculosEnvolvente),c.post("/crearCalculoEnvolvente",auth.isAuthenticated(),b.crearCalculoEnvolvente),c.post("/",b.create),c.post("/sync",auth.isEmpresaAuthenticatedToSync(),b.create),c.put("/:id",auth.isAuthenticated(),b.update),c.patch("/:id",auth.isAuthenticated(),b.update),c["delete"]("/:id",auth.hasRole("admin"),b.destroy),module.exports=c}(),function(){"use strict";function a(a,c,d){b(c,function(b,e){return e?(I.error("ERROR AL OBTENER EMPRESA POR CODIGO"+e),d(!1)):void G.findOne({usuario:a,empresa:b},function(b,e){return b?(I.error("ERROR AL BUSCAR RELACION ENTRE USUARIO Y EMPRESA"+b),d(null)):e?d(e):(I.info("Relación entre usuario "+a+" y empresa "+c+" no encontrada"),d(null))})})}function b(a,b){var c=a.toUpperCase();F.findOne({nombre:c},function(c,d){return c?(I.error("ERROR AL BUSCAR LA EMPRESA POR NOMBRE"+c),b(null)):d?b(d._id):(I.info("Empresa "+a+" no encontrada"),b(null))})}function c(a,b){G.find({usuario:a},{empresa:1,_id:0},function(c,d){if(c)return I.error("ERROR RECUPERANDO LAS EMPRESAS DEL USUARIO"+c),b(null);if(!d)return I.info("EMPRESAS NO ENCONTRADAS PARA EL USUARIO "+a),b(null);for(var e=[],f=0;f<d.length;++f)e.push(d[f].empresa);return b(e)})}function d(a,b){return I.error("Manejando error en informes controller"+b),a.send(500,b)}function e(a,b){for(var c=0;c<b.length;++c)L.create({informe:a,numeroVirola:b[c].numeroVirola,alto:b[c].alto})}function f(a){J.info("Elimina Mediciones Altura Virolas de "+a),L.find({informe:a},function(b,c){b&&I.error("Error al buscar Mediciones Altura Virolas de informe "+a+" "+b),c||I.error("El informe no tiene Mediciones Altura Virolas");for(var d=0;d<c.length;++d)c[d].remove(function(a){a&&I.error("Error al eliminar Medición Altura Virola "+a)})})}function g(a,b){for(var c=0;c<b.length;++c)M.create({informe:a,numeroChapa:b[c].numeroChapa,numeroVirola:b[c].numerovirola,largo:b[c].largo,ancho:b[c].ancho})}function h(a){J.info("Elimina Mediciones Chapa de "+a),M.find({informe:a},function(b,c){b&&I.error("Error al buscar Mediciones Chapa de informe "+a+" "+b),c||I.error("El informe no tiene Mediciones Chapa");for(var d=0;d<c.length;++d)c[d].remove(function(a){a&&I.error("Error al eliminar Medición Altura Virola "+a)})})}function i(a,b){for(var c=0;c<b.length;++c)N.create({informe:a,chapa:b[c].chapa,medicion1:b[c].medicion1,medicion2:b[c].medicion2,medicion3:b[c].medicion3,medicion4:b[c].medicion4,medicion5:b[c].medicion5,medicion6:b[c].medicion6})}function j(a){J.info("Elimina Espesores Piso de "+a),N.find({informe:a},function(b,c){b&&I.error("Error al buscar Espesores Piso de informe "+a+" "+b),c||I.error("El informe no tiene espesores piso");for(var d=0;d<c.length;++d)c[d].remove(function(a){a&&I.error("Error al eliminar Espesor Piso "+a)})})}function k(a,b){for(var c=0;c<b.length;++c)O.create({informe:a,chapa:b[c].chapa,medicion1:b[c].medicion1,medicion2:b[c].medicion2,medicion3:b[c].medicion3,medicion4:b[c].medicion4,medicion5:b[c].medicion5,medicion6:b[c].medicion6})}function l(a){J.info("Elimina Espesores Techo de "+a),O.find({informe:a},function(b,c){b&&I.error("Error al buscar Espesores Techo de informe "+a+" "+b),c||I.error("El informe no tiene espesores Techo");for(var d=0;d<c.length;++d)c[d].remove(function(a){a&&I.error("Error al eliminar Espesor Techo "+a)})})}function m(a,b){for(var c=0;c<b.length;++c)P.create({informe:a,virola:b[c].virola,generatriz:b[c].generatriz,medicion1:b[c].medicion1,medicion2:b[c].medicion2,medicion3:b[c].medicion3,medicion4:b[c].medicion4,medicion5:b[c].medicion5,medicion6:b[c].medicion6})}function n(a){J.info("Elimina Espesores Envolvente de "+a),P.find({informe:a},function(b,c){b&&I.error("Error al buscar Espesores Envolvente de informe "+a+" "+b),c||I.error("El informe no tiene espesores Envolvente");for(var d=0;d<c.length;++d)c[d].remove(function(a){a&&I.error("Error al eliminar Espesor Envolvente "+a)})})}function o(a,b){for(var c=0;c<b.length;++c)Q.create({informe:a,accesorio:b[c].accesorio,diametro:b[c].diametro,medicion0:b[c].medicion0,medicion90:b[c].medicion90,medicion180:b[c].medicion180,medicion270:b[c].medicion270})}function p(a){J.info("Elimina Espesores Accesorios de "+a),Q.find({informe:a},function(b,c){b&&I.error("Error al buscar Espesores Accesorios de informe "+a+" "+b),c||I.error("El informe no tiene espesores Accesorios");for(var d=0;d<c.length;++d)c[d].remove(function(a){a&&I.error("Error al eliminar Espesor Accesorios "+a)})})}function q(a){return function(b,c){var d=0;return b[a]<c[a]?d=-1:b[a]>c[a]&&(d=1),d}}function r(a,b){return function(c,d){var e=0;return c[a][b]>d[a][b]?e=-1:c[a][b]<d[a][b]&&(e=1),e}}function s(a,b){for(var c=0;c<b.length;++c)R.create({informe:a,estacion:b[c].estacion,medicion:b[c].medicion,observaciones:b[c].observaciones})}function t(a){J.info("Elimina Espesores Asentamiento de "+a),R.find({informe:a},function(b,c){b&&I.error("Error al buscar Espesores Asentamiento de informe "+a+" "+b),c||I.error("El informe no tiene espesores Asentamiento");for(var d=0;d<c.length;++d)c[d].remove(function(a){a&&I.error("Error al eliminar Espesor Asentamiento "+a)})})}function u(a,b){for(var c=0;c<b.length;++c)S.create({informe:a,cuna:b[c].cuna,punto:b[c].punto,medicion1:b[c].medicion1,medicion2:b[c].medicion2,medicion3:b[c].medicion3,medicion4:b[c].medicion4,medicion5:b[c].medicion5,medicion6:b[c].medicion6,medicion7:b[c].medicion7,medicion8:b[c].medicion8,medicion9:b[c].medicion9,medicion10:b[c].medicion10,medicion11:b[c].medicion11,medicion12:b[c].medicion12,medicion13:b[c].medicion13,medicion14:b[c].medicion14,medicion15:b[c].medicion15,medicion16:b[c].medicion16,medicion17:b[c].medicion17,medicion18:b[c].medicion18,medicion19:b[c].medicion19,medicion20:b[c].medicion20,medicion21:b[c].medicion21,medicion22:b[c].medicion22,medicion23:b[c].medicion23,medicion24:b[c].medicion24,medicion25:b[c].medicion25,medicion26:b[c].medicion26,medicion27:b[c].medicion27,medicion28:b[c].medicion28,medicion29:b[c].medicion29,medicion30:b[c].medicion30,medicion31:b[c].medicion31,medicion32:b[c].medicion32})}function v(a){J.info("Elimina Espesores Cunas de "+a),S.find({informe:a},function(b,c){b&&I.error("Error al buscar Espesores Cunas de informe "+a+" "+b),c||I.error("El informe no tiene espesores Cunas");for(var d=0;d<c.length;++d)c[d].remove(function(a){a&&I.error("Error al eliminar Espesor Cunas "+a)})})}function w(a,b){for(var c=0;c<b.length;++c)T.create({informe:a,lado:b[c].lado,generatriz:b[c].generatriz,medicion1:b[c].medicion1,medicion2:b[c].medicion2,medicion3:b[c].medicion3,medicion4:b[c].medicion4,medicion5:b[c].medicion5,medicion6:b[c].medicion6})}function x(a){J.info("Elimina Espesores Cabezales de "+a),T.find({informe:a},function(b,c){b&&I.error("Error al buscar Espesores Cabezales de informe "+a+" "+b),c||I.error("El informe no tiene espesores Cabezales");for(var d=0;d<c.length;++d)c[d].remove(function(a){a&&I.error("Error al eliminar Espesor Cabezales "+a)})})}function y(a,b){for(var c=0;c<b.length;++c)U.create({informe:a,pasada:b[c].pasada,chapa:b[c].chapa,acceso:b[c].acceso,amolado:b[c].amolado,corrosion:b[c].corrosion,deformacion:b[c].deformacion,perforacion:b[c].perforacion,otra:b[c].otra,puntosoldadura:b[c].puntosoldadura,observaciones:b[c].observaciones})}function z(a){J.info("Elimina Observaciones MFL de "+a),U.find({informe:a},function(b,c){b&&I.error("Error al buscar Observaciones MFL de informe "+a+" "+b),c||I.error("El informe no tiene observacion MFL");for(var d=0;d<c.length;++d)c[d].remove(function(a){a&&I.error("Error al eliminar Observaciones MFL "+a)})})}function A(a){J.info("Elimina Calculo de Espesores Envolvente de "+a),V.find({informe:a},function(b,c){if(b&&I.error("Error al buscar Cálculo de Espesor Envolvente de informe "+a+" "+b),c)for(var d=0;d<c.length;++d)c[d].remove(function(a){a&&I.error("Error al eliminar cálculo de espesor Envolvente "+a)});else I.error("El informe no tiene cálculos de espesores Envolvente")})}function B(a){J.info("Elimina Calculos de Envolvente de "+a),W.findOne({informe:a},function(b,c){b&&I.error("Error al buscar Cálculo de Espesor Envolvente horizontal de informe "+a+" "+b),c?c.remove(function(a){a&&I.error("Error al eliminar cálculo de espesor Envolvente horizontal "+a)}):J.info("El informe no tiene cálculos de espesores Envolvente horizontal ")})}var C=require("lodash"),D=require("./informe.model"),E=require("../foto/foto.controller"),F=require("../empresa/empresa.model"),G=require("../usuarioempresa/usuarioempresa.model"),H=require("winston"),I=H.loggers.get("sistac-error"),J=H.loggers.get("sistac-info"),K=require("../../auth/auth.service");exports.getInformesUsuario=function(a,b){K.hasEspecificRole(a.user.role,"admin")?D.find(function(a,c){return a?d(b,a):(J.info("Buscando informes con perfil admin"),b.json(200,c.sort(r("informeCampoDetails","fechaHora"))))}):c(a.user._id,function(a,c){return c?(I.error("ERROR AL FILTRAR INFORMES POR USUARIO "+c),d(a,c)):void D.find({empresa:{$in:a}},function(a,c){return a?(I.error("ERROR AL OBTENER EMPRESAS POR USUARIO"+a),d(b,a)):b.json(200,c.sort(r("informeCampoDetails","fechaHora")))})})},exports.show=function(b,c){D.findById(b.params.id,function(e,f){return e?(I.error("ERROR AL OBTENER INFORME"+e),d(c,e)):f?K.hasEspecificRole(b.user.role,"admin")?(J.info("Obtiene Informe con perfil Admin"),c.json(f)):void a(b.user._id,f.codigoEmpresa,function(a,e){return e?(I.error("ERROR AL VALIDAR AL USUARIO "+e),d(a,e)):a?c.json(f):(I.info("El usuario "+b.user.name+" no tiene permisos para el informe "+b.params.id),c.send(401))}):(I.info("NO SE ENCONTRO EL INFORME BUSCADO POR ID: "+b.params.id),c.send(404))})},exports.create=function(a,c){null===a.body.codigoEmpresa&&(I.info("A punto de crear un informe con código de empresa nulo"),a.body.codigoEmpresa=""),b(a.body.codigoEmpresa,function(b,f){if(f)return I.error("ERROR AL ENCONTRAR EMPRESA"+f),d(b,f);a.body.empresa=b;var h=a.body.medicionesAlturaVirolas,j=a.body.medicionesChapas,l=a.body.espesoresPiso,n=a.body.espesoresTecho,p=a.body.espesoresEnvolvente,q=a.body.espesoresAccesorios,r=a.body.espesoresAsentamiento,t=a.body.espesoresCunas,v=a.body.espesoresCabezales,x=a.body.observacionesMFL;D.create(a.body,function(a,b){return a?(I.error("ERROR AL CREAR INFORME"+a),d(c,a)):(e(b._id,h),g(b._id,j),i(b._id,l),k(b._id,n),m(b._id,p),o(b._id,q),s(b._id,r),u(b._id,t),w(b._id,v),y(b._id,x),c.json(201,b._id))})})},exports.update=function(c,e){c.body._id&&delete c.body._id,D.findById(c.params.id,function(f,g){if(f)return d(e,f);if(!g)return e.send(404);if(K.hasEspecificRole(c.user.role,"admin")){var h=c.body;null===h.codigoEmpresa&&(h.codigoEmpresa=""),b(h.codigoEmpresa,function(a,b){if(b)return d(a,b);h.empresa=a;var c=C.merge(g,h);c.save(function(a){return a?(I.error("ERROR AL ACTUALIZAR EL INFORME  "+a),d(e,a)):e.json(200,g)})})}else a(c.user._id,g.codigoEmpresa,function(a,f){if(f)return I.error("ERROR AL VALIDAR AL USUARIO "+f),d(a,f);if(!a)return J.info("El usuario "+c.user.name+" no tiene permisos para el informe "+c.params.id),e.send(401);var h=c.body;null===h.codigoEmpresa&&(h.codigoEmpresa=""),b(h.codigoEmpresa,function(a,b){if(b)return d(a,b);h.empresa=a;var c=C.merge(g,h);c.save(function(a){return a?d(e,a):e.json(200,g)})})})})},exports.destroy=function(a,b){D.findById(a.params.id,function(c,e){return c?d(b,c):e?(a.params.idTanque=e.informeCampoDetails.idTanque,E.deleteByInformeId(a,b),f(e._id),h(e._id),l(e._id),j(e._id),n(e._id),p(e._id),t(e._id),v(e._id),x(e._id),z(e._id),A(e._id),B(e._id),void e.remove(function(a){return a?d(b,a):b.send(204)})):b.send(404)})};var L=require("./medicionesalturavirolas.model"),M=require("./medicioneschapa.model"),N=require("./espesoresPiso.model"),O=require("./espesoresTecho.model"),P=require("./espesoresEnvolvente.model"),Q=require("./espesoresAccesorios.model"),R=require("./espesoresAsentamiento.model"),S=require("./espesoresCunas.model"),T=require("./espesoresCabezales.model"),U=require("./observacionesMFL.model"),V=require("./calculosEspesores.model"),W=require("./calculosEnvolvente.model");exports.getMedicionesAlturaVirolas=function(a,b){L.find({informe:a.params.informeId},function(c,d){return c&&I.error("Error al buscar las mediciones en la altura de las virolas "+a.params.informeId),b.json(200,d.sort(q("numeroVirola")))})},exports.getMedicionesChapa=function(a,b){M.find({informe:a.params.informeId},function(c,d){return c&&I.error("Error al buscar las mediciones del informe "+a.params.informeId),b.json(200,d)})},exports.getEspesoresPiso=function(a,b){N.find({informe:a.params.informeId},function(c,d){return c&&I.error("Error al buscar los espesores de Piso del informe "+a.params.informeId),b.json(200,d.sort(q("chapa")))})},exports.updateEspesoresPiso=function(a,b){N.findById(a.body._id,function(c,e){if(c)return d(b,c);if(!e)return b.send(404);var f=C.merge(e,a.body);f.save(function(a){return a?d(b,a):b.json(200,e)})})},exports.getEspesoresTecho=function(a,b){O.find({informe:a.params.informeId},function(c,d){return c&&I.error("Error al buscar los espesores de Techo del informe "+a.params.informeId),b.json(200,d.sort(q("chapa")))})},exports.updateEspesoresTecho=function(a,b){O.findById(a.body._id,function(c,e){if(c)return d(b,c);if(!e)return b.send(404);var f=C.merge(e,a.body);f.save(function(a){return a?d(b,a):b.json(200,e)})})},exports.getEspesoresEnvolvente=function(a,b){P.find({informe:a.params.informeId},function(c,d){return c&&I.error("Error al buscar los espesores de Envolvente del informe "+a.params.informeId),b.json(200,d.sort(q("virola")))})},exports.updateEspesoresEnvolvente=function(a,b){P.findById(a.body._id,function(c,e){if(c)return d(b,c);if(!e)return b.send(404);var f=C.merge(e,a.body);f.save(function(a){return a?d(b,a):b.json(200,e)})})},exports.getEspesoresAccesorios=function(a,b){Q.find({informe:a.params.informeId},function(c,d){return c&&I.error("Error al buscar los espesores de Accesorios del informe "+a.params.informeId),b.json(200,d)})},exports.updateEspesoresAccesorios=function(a,b){Q.findById(a.body._id,function(c,e){if(c)return d(b,c);if(!e)return b.send(404);var f=C.merge(e,a.body);f.save(function(a){return a?d(b,a):b.json(200,e)})})},exports.getEspesoresAsentamiento=function(a,b){R.find({informe:a.params.informeId},function(c,d){return c&&I.error("Error al buscar los espesores de Asentamiento del informe "+a.params.informeId),b.json(200,d.sort(q("estacion")))})},exports.updateEspesoresAsentamiento=function(a,b){R.findById(a.body._id,function(c,e){if(c)return d(b,c);if(!e)return b.send(404);var f=C.merge(e,a.body);f.save(function(a){return a?d(b,a):b.json(200,e)})})},exports.getEspesoresCunas=function(a,b){S.find({informe:a.params.informeId},function(c,d){return c&&I.error("Error al buscar los espesores de Cunas del informe "+a.params.informeId),
b.json(200,d.sort(q("cuna")))})},exports.updateEspesoresCunas=function(a,b){S.findById(a.body._id,function(c,e){if(c)return d(b,c);if(!e)return b.send(404);var f=C.merge(e,a.body);f.save(function(a){return a?d(b,a):b.json(200,e)})})};var X=function(a,b,c){a.status(b),a.json(c),400!==b&&404!==b||I.error(c)};exports.cabezalesInfoByInformeId=function(a,b){return a.params.id?void D.findById(a.params.id).select("informeCampoDetails.orientacionLadoA informeCampoDetails.orientacionLadoB informeCampoDetails.tipoTanque").exec(function(c,d){return console.log(d),c?X(b,400,c):d?"HORIZONTAL"!==d.informeCampoDetails.tipoTanque?X(b,400,{message:"El tanque no es horizontal"}):X(b,200,{orientacionLadoA:d.orientacionLadoA,orientacionLadoB:d.orientacionLadoB}):X(b,404,{message:"informe not found by id: "+a.params.id})}):X(b,404,{message:"informeId not found in request params"})},exports.getEspesoresCabezales=function(a,b){T.find({informe:a.params.informeId},function(c,d){return c&&I.error("Error al buscar los espesores de Cabezales del informe "+a.params.informeId),b.json(200,d.sort(q("lado")))})},exports.updateEspesoresCabezales=function(a,b){T.findById(a.body._id,function(c,e){if(c)return d(b,c);if(!e)return b.send(404);var f=C.merge(e,a.body);f.save(function(a){return a?d(b,a):b.json(200,e)})})},exports.getObservacionesMFL=function(a,b){U.find({informe:a.params.informeId},function(c,d){return c&&I.error("Error al buscar las Observaciones MFL del informe "+a.params.informeId),b.json(200,d)})},exports.updateObservacionesMFL=function(a,b){U.findById(a.body._id,function(c,e){if(c)return d(b,c);if(!e)return b.send(404);var f=C.merge(e,a.body);f.save(function(a){return a?d(b,a):b.json(200,e)})})},exports.getCalculosEspesores=function(a,b){V.find({informe:a.params.informeId},function(c,d){return c&&I.error("Error al buscar los cálculos de espesores Envolvente del informe "+a.params.informeId),b.json(200,d.sort(q("unidad")))})},exports.crearCalculoEspesor=function(a,b){var c=a.body.calculoEspesor,e=a.body.informeId;V.create({informe:e,unidad:c.unidad,h:c.h,d:c.d,g:c.g,s:c.s,e:c.e,tmin:c.tmin,tc:c.tc,tmedido:c.tmedido,tasa:c.tasa,vida:c.vida,alturaSegura:c.alturaSegura},function(a,c){return a?(I.error("Error al guardar cálculo de espesor envolvente "+a),d(b,a)):b.json(201,c)})},exports.updateCalculosEspesores=function(a,b){V.findById(a.body._id,function(c,e){if(c)return I.error("Error al guardar cálculo de espesor envolvente "+c),d(b,c);if(!e)return I.error("Cálculo de espesor envolvente a guardar inexistente "+c),b.send(404);var f=C.merge(e,a.body);f.save(function(a){return a?(I.error("Error al guardar cálculo de espesor envolvente "+a),d(b,a)):b.json(200,e)})})},exports.crearCalculoEnvolvente=function(a,b){var c=a.body.calculoEspesor,e=a.body.informeId;W.create({informe:e,alturaSegura:c.alturaSegura,promedioZC:c.promedioZC,minimoZC:c.minimoZC,maximoZC:c.maximoZC,nominalZC:c.nominalZC,perdidaZC:c.perdidaZC,corrosionZC:c.corrosionZC,vidaZC:c.vidaZC,promedioEn:c.promedioEn,minimoEn:c.minimoEn,maximoEn:c.maximoEn,nominalEn:c.nominalEn,perdidaEn:c.perdidaEn,corrosionEn:c.corrosionEn,vidaEn:c.vidaEn,promedioCa:c.promedioCa,minimoCa:c.minimoCa,maximoCa:c.maximoCa,nominalCa:c.nominalCa,perdidaCa:c.perdidaCa,corrosionCa:c.corrosionCa,vidaCa:c.vidaCa},function(a,c){return a?(I.error("Error al guardar cálculo de espesor envolvente horizontal "+a),d(b,a)):b.json(201,c)})},exports.getCalculosEnvolvente=function(a,b){W.findOne({informe:a.params.informeId},function(c,d){return c&&I.error("Error al buscar los cálculos de espesores Envolvente del informe horizontal "+a.params.informeId),d?b.json(200,d):b.send(300,"Cálculos no encontrados")})},exports.updateCalculosEnvolvente=function(a,b){W.findById(a.body._id,function(c,e){if(c)return I.error("Error al guardar cálculo de envolvente horizontal "+c),d(b,c);if(!e)return I.error("Cálculo de espesor envolvente horizontal a guardar inexistente "+c),b.send(404);var f=C.merge(e,a.body);f.save(function(a){return a?(I.error("Error al guardar cálculo de espesor envolvente horizontal "+a),d(b,a)):b.json(200,e)})})}}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=require("mongoose-auto-increment"),d=new b({informeCampoDetails:{idTanque:String,cit:String,fechaHora:Date,syncTime:String,operador:String,inspector:String,calle:String,localidad:String,provincia:String,tipoTanque:String,tipoInspeccion:String,volumen:String,entidadAuditora:String,anoFabricacion:String,orientacionLadoA:String,orientacionLadoB:String},primeraSeccion:{perimetro:Number,altura:Number,tienePlacaTk:Boolean,tieneNumero:Boolean,tieneCapacidadNominal:Boolean,tieneProductoAlmacenado:Boolean,tieneLogoOperador:Boolean,tieneHormigonArmado:Boolean,tieneIdentificadorRiesgo:Boolean,tieneCartaConversion:Boolean,tienePestaniaPiso:Boolean,tieneTalonBituminoso:Boolean,tieneAnclajes:Boolean,tieneMamposteria:Boolean,tieneAceroHierro:Boolean,tieneNumeroObservaciones:String,tienePlacaTkObservaciones:String,tieneIdentificadorRiesgoObservaciones:String,tieneCartaConversionObservaciones:String,tieneProductoAlmacenadoObservaciones:String,tieneCapacidadNominalObservaciones:String,tieneLogoOperadorObservaciones:String,tienePestaniaPisoObservaciones:String,tieneTalonBituminosoObservaciones:String,tieneHormigonArmadoObservaciones:String,tieneAnclajesObservaciones:String,alturaObservaciones:String,perimetroObservaciones:String,mamposteriaObservaciones:String,aceroHierroObservaciones:String},segundaSeccion:{tieneSoldaduras:Boolean,tieneGlobos:Boolean,tieneMedidorNivelPared:Boolean,tieneBocaLimpieza:Boolean,tieneBocaHombre:Boolean,tieneHundimientos:Boolean,tieneSuccion:Boolean,tieneCarga:Boolean,tieneDrenaje:Boolean,tieneTelemedicion:Boolean,tienePintura:Boolean,metodoCalefaccion:String,tienePinturaObservaciones:String,tieneTelemedicionObservaciones:String,tieneDrenajeObservaciones:String,tieneCargaObservaciones:String,tieneSuccionObservaciones:String,tieneMedidorNivelParedObservaciones:String,tieneBocaHombreObservaciones:String,tieneBocaLimpiezaObservaciones:String,tieneHundimientosObservaciones:String,tieneGlobosObservaciones:String,tieneSoldadurasObservaciones:String,cantidadChapasVirola:Number,cantidadVirolas:Number},terceraSeccion:{tieneTecho:Boolean,tipoTecho:String,tieneChapasTecho:Boolean,tieneSellos:Boolean,tieneRespiradores:Boolean,tieneBocaHombreTecho:Boolean,tieneMedidorNivel:Boolean,tieneCanieria:Boolean,tieneVenteos:Boolean,tieneValvulas:Boolean,tieneSuccion:Boolean,tieneControlNivel:Boolean,tieneTelemedicion:Boolean,succionObservaciones:String,controlNivelObservaciones:String,tieneBarandaPerimetral:String,pinturaObservaciones:String,tipoTechoObservaciones:String,chapasTechoObservaciones:String,sellosObservaciones:String,respiradoresObservaciones:String,bocaHombreTechoObservaciones:String,medidorNivelObservaciones:String,canieriaObservaciones:String,venteosObservaciones:String,valvulasObservaciones:String,telemedicionObservaciones:String,tieneProteccionCatodica:Boolean,tieneTomasTierra:Boolean,tienePararrayos:Boolean,proteccionCatodicaObservaciones:String,tomasTierraObservaciones:String,pararrayosObservaciones:String,tieneChapasPiso:Boolean,tieneFlujoMagnetico:Boolean,tieneEmisionAcustica:Boolean,chapasPisoObservaciones:String,flujoMagneticoObservaciones:String,emisionAcusticaObservaciones:String,tienePoncho:Boolean,ponchoObservaciones:String,tienePintura:Boolean,tieneSuccionA:Boolean,tieneSuccionB:Boolean,tieneMedidorNivelA:Boolean,tieneMedidorNivelB:Boolean,tieneCargaB:Boolean,medidorNivelAObservaciones:String,medidorNivelBObservaciones:String,succionAObservaciones:String,succionBObservaciones:String,cargaBObservaciones:String,tieneBocaMedicion:Boolean,bocaMedicionObservaciones:String},cuartaSeccion:{tienePlataforma:Boolean,tienePeldanios:Boolean,tieneMetodoRecuperacion:Boolean,tieneDescansos:Boolean,tieneBaranda:Boolean,plataformaObservaciones:String,peldaniosObservaciones:String,descansosObservaciones:String,tieneBarandaObservaciones:String,tieneRecintoCompartido:Boolean,tieneDrenajesRecinto:Boolean,tieneIluminacionRecinto:Boolean,largoRecinto:Number,anchoRecinto:Number,altoRecinto:Number,recintoCompartidoObservaciones:String,recintoIluminacionObservaciones:String,recintoDrenajesObservaciones:String,metodoRecuperacionObservaciones:String,tieneRampas:Boolean,cantidadRampas:Number,tieneRampaPasarela:Boolean,tieneRampaEscalones:Boolean,tieneRampaIluminacion:Boolean,rampaCantidadObservaciones:String,rampaPasarelaObservaciones:String,tieneRampaEscalonesObservaciones:String,tieneRampaIluminacionObservaciones:String},quintaSeccion:{tieneFlotante:Boolean,tieneAlambre:Boolean,tieneGuiasAlambre:Boolean,flotanteObservaciones:String,alambreObservaciones:String,tieneGuiasAlambreObservaciones:String,tieneMantenimientoTanque:Boolean,tieneMantenimientoCanierias:Boolean,tieneMantenimientoRecinto:Boolean,tieneInpeccionesAnteriores:Boolean,mantenimientoTanqueObservaciones:String,mantenimientoCanieriasObservaciones:String,mantenimientoRecintoObservaciones:String,tieneInspeccionesAnterioresObservaciones:String,tipoInspeccion:String,caracteristicaTanque:String,latitud:Number,longitud:Number},sextaSeccion:{tieneExtintores10K:Boolean,tieneExtintores50K:Boolean,tieneEspumigeno:Boolean,tieneRociadores:Boolean,tieneHidrantes:Boolean,tieneLanzas:Boolean,tieneBaldes:Boolean,tieneServicioPropioBomberos:Boolean,extintores10KObservaciones:String,extintores50KObservaciones:String,espumigenoObservaciones:String,rociadoresObservaciones:String,hidrantesObservaciones:String,lanzasObservaciones:String,servicioPropioBomberosObservaciones:String,baldesObservaciones:String,extintores10KClase:String,extintores50KClase:String,extintores10KCantidad:Number,lanzasCantidad:Number,extintores50KCantidad:Number,rociadoresCantidad:Number,espumigenoCantidad:Number,hidrantesCantidad:Number,extintores10KClaseObservaciones:String,extintores50KClaseObservaciones:String,extintores10KCantidadObservaciones:String,extintores50KCantidadObservaciones:String,observacionesGenerales:String,lanzasCantidadObservaciones:String,espumigenoCantidadObservaciones:String,rociadoresCantidadObservaciones:String,hidrantesCantidadObservaciones:String},active:{type:Boolean,"default":!0},empresa:{type:b.Types.ObjectId,ref:"Empresa"},codigoEmpresa:{type:String,uppercase:!0},ordenCompra:String,contrato:String,asentamientoDetails:{moduloElastico:Number,tensionFluencia:Number,distanciaEntrePuntos:Number,defleccionPermitida:Number,defleccionMedida:Number,factorK:Number,defleccionPermitida2:Number,defleccionMedida2:Number,sarcCurva1:Number,sarcCurva2:Number,sarcCurva3:Number,defleccionMedidaCurva1:Number,defleccionMedidaCurva2:Number,defleccionMedidaCurva3:Number,medInicialCurva1:Number,medMinimoCurva1:Number,medFinalCurva1:Number,disInicialCurva1:Number,disMinimoCurva1:Number,disFinalCurva1:Number,medInicialCurva2:Number,medMinimoCurva2:Number,medFinalCurva2:Number,disInicialCurva2:Number,disMinimoCurva2:Number,disFinalCurva2:Number,medInicialCurva3:Number,medMinimoCurva3:Number,medFinalCurva3:Number,disInicialCurva3:Number,disMinimoCurva3:Number,disFinalCurva3:Number},espesoresDetails:{densidadProducto:Number}});d.plugin(c.plugin,{model:"Informe",field:"sequence",startAt:1}),module.exports=a.model("Informe",d)}(),function(){"use strict";var a=(require("should"),require("../../app")),b=require("supertest");describe("GET /lab/informes",function(){it("should respond with JSON array",function(c){b(a).get("/lab/informes").expect(200).expect("Content-Type",/json/).end(function(a,b){return a?c(a):(b.body.should.be["instanceof"](Array),void c())})})})}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({informe:{type:b.Types.ObjectId,ref:"Informe"},numeroVirola:String,alto:String});module.exports=a.model("MedicionesAlturaVirolas",c)}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({informe:{type:b.Types.ObjectId,ref:"Informe"},numeroChapa:{type:String,required:!0},numeroVirola:{type:String,required:!0},largo:{type:String,required:!0},ancho:{type:String,required:!0}});module.exports=a.model("MedicionesChapa",c)}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({informe:{type:b.Types.ObjectId,ref:"Informe"},pasada:Number,chapa:Number,acceso:Boolean,amolado:Boolean,corrosion:Boolean,deformacion:Boolean,perforacion:Boolean,otra:Boolean,puntosoldadura:Boolean,observaciones:String});module.exports=a.model("ObservacionesMFL",c)}(),function(){"use strict";var a=require("express"),b=require("./user.controller"),c=(require("../../config/environment"),require("../../auth/auth.service")),d=a.Router();d.get("/",c.hasRole("admin"),b.index),d["delete"]("/:id",c.hasRole("admin"),b.destroy),d.get("/me",c.isAuthenticated(),b.me),d.put("/:id/password",c.hasRole("admin"),b.changePassword),d.get("/:id",c.hasRole("admin"),b.show),d.post("/",c.hasRole("admin"),b.create),module.exports=d}(),function(){"use strict";function a(a){a.remove(function(a){a&&console.log("ERROR ELIMINANDO LA RELACION ENTRE EMPRESAS Y USUARIO "+a)})}var b=require("./user.model"),c=(require("passport"),require("../../config/environment")),d=require("jsonwebtoken"),e=require("../usuarioempresa/usuarioempresa.model"),f=function(a,b){return a.json(422,b)};exports.index=function(a,c){b.find({},"-salt -hashedPassword",function(a,b){return a?c.send(500,a):void c.json(200,b)})},exports.create=function(a,e,g){var h=new b(a.body);h.provider="local",h.save(function(a,b){if(a)return f(e,a);var g=d.sign({_id:b._id},c.secrets.session,{expiresInMinutes:300});e.json({token:g})})},exports.show=function(a,c,d){var e=a.params.id;b.findById(e,function(a,b){return a?d(a):b?void c.json(b.profile):c.send(401)})},exports.destroy=function(c,d){b.findByIdAndRemove(c.params.id,function(b,f){return b?d.send(500,b):(e.find({usuario:c.params.id},function(b,c){b&&console.log("ERROR RECUPERANDO LAS RELACIONES ENTRE EMPRESAS Y USUARIO "+b),c||console.log("EL USUARIO A ELIMINAR NO TIENE RELACIONES CON EMPRESAS");for(var d=0;d<c.length;++d)console.log("ELIMINO RELACION EMPRESA/USUARIO"),a(c[d])}),d.send(204))})},exports.changePassword=function(a,c,d){var e=a.user._id,g=String(a.body.oldPassword),h=String(a.body.newPassword);b.findById(e,function(a,b){b.authenticate(g)?(b.password=h,b.save(function(a){return a?f(c,a):void c.send(200)})):c.send(403)})},exports.me=function(a,c,d){var e=a.user._id;b.findOne({_id:e},"-salt -hashedPassword",function(a,b){return a?d(a):b?void c.json(b):c.json(401)})},exports.syncTokenRequest=function(a,e,f){console.log(a.body);var g=String(a.body.email),h=String(a.body.password);b.findOne({email:g},function(a,b){if(a)return f(a);if(!b)return e.send(404);if(b.authenticate(h)){var g=d.sign({_id:b._id},c.secrets.mobileAuthToken,{expiresInMinutes:1});return e.json({email:b.email,name:b.name,token:g})}return e.setHeader("WWW-Authenticate","user:pass incorrect"),e.send(401)})},exports.authCallback=function(a,b,c){b.redirect("/")}}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=require("crypto"),d=require("mongoose-auto-increment"),e=new b({name:String,direccion:String,telefono:String,contacto:String,image:{type:String,"default":"assets/images/account_circle_black.png"},email:{type:String,lowercase:!0,index:{unique:!0}},role:{type:String,"default":"user"},hashedPassword:String,provider:String,salt:String,active:{type:Boolean,"default":!0}});e.virtual("password").set(function(a){this._password=a,this.salt=this.makeSalt(),this.hashedPassword=this.encryptPassword(a)}).get(function(){return this._password}),e.virtual("profile").get(function(){return{name:this.name,direccion:this.direccion,telefono:this.telefono,contacto:this.contacto,image:this.image,email:this.email,role:this.role}}),e.virtual("token").get(function(){return{_id:this._id}}),e.path("email").validate(function(a){return a.length},"Email cannot be blank"),e.path("hashedPassword").validate(function(a){return a.length},"Password cannot be blank"),e.path("email").validate(function(a,b){var c=this;this.constructor.findOne({email:a},function(a,d){if(a)throw a;return d?b(c.id===d.id?!0:!1):void b(!0)})},"The specified email address is already in use.");var f=function(a){return a&&a.length};e.pre("save",function(a){return this.isNew?void(f(this.hashedPassword)?a():a(new Error("Invalid password"))):a()}),e.methods={authenticate:function(a){return this.encryptPassword(a)===this.hashedPassword},makeSalt:function(){return c.randomBytes(16).toString("base64")},encryptPassword:function(a){if(!a||!this.salt)return"";var b=new Buffer(this.salt,"base64");return c.pbkdf2Sync(a,b,1e4,64).toString("base64")}},e.plugin(d.plugin,{model:"User",field:"sequence",startAt:1}),module.exports=a.model("User",e)}(),function(){"use strict";var a=require("should"),b=(require("../../app"),require("./user.model")),c=new b({provider:"local",name:"Fake User",email:"test@test.com",password:"password"});describe("User Model",function(){before(function(a){b.remove().exec().then(function(){a()})}),afterEach(function(a){b.remove().exec().then(function(){a()})}),it("should begin with no users",function(a){b.find({},function(b,c){c.should.have.length(0),a()})}),it("should fail when saving a duplicate user",function(d){c.save(function(){var e=new b(c);e.save(function(b){a.exist(b),d()})})}),it("should fail when saving without an email",function(b){c.email="",c.save(function(c){a.exist(c),b()})}),it("should authenticate user if password is valid",function(){return c.authenticate("password").should.be["true"]}),it("should not authenticate user if password is invalid",function(){return c.authenticate("blah").should.not.be["true"]})})}(),function(){"use strict";var a=require("express"),b=require("./usuarioempresa.controller"),c=require("../../auth/auth.service"),d=a.Router();d.get("/",c.hasRole("admin"),b.index),d.get("/:idEmpresa",c.hasRole("admin"),b.getUsuariosEmpresa),d.post("/",c.hasRole("admin"),b.create),d.put("/:id",c.hasRole("admin"),b.update),d.patch("/:id",c.hasRole("admin"),b.update),d["delete"]("/:id",c.hasRole("admin"),b.destroy),module.exports=d}(),function(){"use strict";function a(a,b){return a.send(500,b)}var b=require("lodash"),c=require("./usuarioempresa.model");exports.index=function(b,d){c.find(function(b,c){return b?a(d,b):d.json(200,c)}).populate("empresa").populate("usuario")},exports.getUsuariosEmpresa=function(b,d){c.find({empresa:b.params.idEmpresa},function(c,e){if(c)return console.log("ERROR "+c+b.params.idEmpresa),a(d,c);if(!e)return d.send(404);for(var f=[],g=0;g<e.length;++g)try{var h={name:e[g].usuario.name,email:e[g].usuario.email,_id:e[g].usuario._id,idEmpresa:e[g]._id,image:e[g].usuario.image};f.push(h)}catch(i){}return d.json(f)}).populate("usuario")},exports.create=function(b,d){c.create(b.body,function(b,c){return b?a(d,b):d.json(201,c)})},exports.update=function(d,e){d.body._id&&delete d.body._id,c.findById(d.params.id,function(c,f){if(c)return a(e,c);if(!f)return e.send(404);var g=b.merge(f,d.body);g.save(function(b){return b?a(e,b):e.json(200,f)})})},exports.destroy=function(b,d){c.findById(b.params.id,function(b,c){return b?a(d,b):c?void c.remove(function(b){return b?a(d,b):d.send(204)}):d.send(404)})}}(),function(){"use strict";var a=require("mongoose"),b=a.Schema,c=new b({empresa:{type:b.Types.ObjectId,ref:"Empresa"},usuario:{type:b.Types.ObjectId,ref:"User"}});module.exports=a.model("Usuarioempresa",c)}(),function(){"use strict";var a=(require("should"),require("../../app")),b=require("supertest");describe("GET /lab/usuariosempresas",function(){it("should respond with JSON array",function(c){b(a).get("/lab/usuariosempresas").expect(200).expect("Content-Type",/json/).end(function(a,b){return a?c(a):(b.body.should.be["instanceof"](Array),void c())})})})}();